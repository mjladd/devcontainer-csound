# 2. NOTE OFF: with code 128, and also containing two values, a note number and

2. NOTE OFF: with code 128, and also containing two values, a note number and
velocity. This message can also be emulated with a NOTE ON containing zero
velocity.
3. aftertouch: using code 208 and containing a single value, the amount of after-
touch. This is typically generated by a keyboard whose keys are pressed down
while being played.
4. polyphonic aftertouch: whose code is 166, and provides a note-by-note after-
touch control with two data values (note number and amount).
5. program change: code 192, carries one single value, the program number. This
is often used to change stored parameter sets in music devices.
6. control change: using code 176, carries two values, a control number and a
value. It is used for interactive parameter adjustments.
7. pitch bend: code 224, also carrying two values, a coarse and a ﬁne pitch bend
amount, which can be combined to control parameters (such as frequency).
9.3 The Csound MIDI System
173
Note that while these messages were originally intended for particular purposes,
they can be mapped to any function. There is nothing stopping, for instance, pitch
bend being mapped to ﬁlter frequency, or any other parameter in a given instrument.
Even NOTE messages, which are normally associated with starting and stopping
sounds, can be reassigned to other ends.
9.3 The Csound MIDI System
Csound has a very straightforward MIDI input implementation. By default, NOTE
ON messages are sensed and trigger instrument instances. These instances are al-
located as usual, but have a particular characteristic: as discussed in Section 5.3.3,
they will have indeterminate duration (i.e. a negative p3 value). NOTE OFF mes-
sages with a matching note number will stop them playing. So, for this standard
type of MIDI operation, we need to make sure our instruments do not depend on p3.
Many of the Opcodes that do depend on p3 have versions designed to be indepen-
dent of a set duration (the ‘r’ ones introduced in Section 5.3.4).
Also by default, channels are tied in to their respective instrument numbers: chan-
nel 1 to instr 1 through channel 16 to instr 16. If one of these is not deﬁned, instru-
ment 1 or the lowest-order instrument will be used. It is possible to modify this
using the massign opcode:
massign ichnl, instr
where ichnl is the channel to be assign to instr instr. It is also possible to link
program numbers with instruments using pgmassign:
pgmassign ipgm, instr[, ichn]
where ipgm is the program to be assigned to instr instr.
Note that Csound has unlimited polyphony by default, so it will respond to any
number of simultaneous NOTE ON messages. However, given that computers have
various ﬁnite levels of resources, the practical number of notes played together will
not be unlimited. While Csound does not have any built-in voice-stealing or real-
location mechanism, such things can be constructed in user code. The maxalloc
and active opcodes can be used to limit the allocation for a given instrument and
ﬁnd the number of currently active instances, respectively. In additiion, cpuprc
or cpumeter can be used to check for CPU use (although these two opcodes are
currently only available on Linux).
9.3.1 Input
MIDI input opcodes can be separated into two categories:
174
9 MIDI Input and Output