{"instruction": "Write a CSound instrument that demonstrates the distort opcode for waveshaping distortion", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function tables\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; distort opcode: ares distort asig, kdist, ifn [, ihp] [, istor]\n    ; distort applies waveshaping distortion\n    ; asig - input audio signal\n    ; kdist - distortion amount (0-1, higher = more distortion)\n    ; ifn - transfer function table\n    ; ihp - highpass filter cutoff (optional, default 10 Hz)\n    ; istor - skip initialization (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Clean sine wave\n    aOsc poscil kAmp*0.3, 220, giSine\n    \n    ; Apply distortion\n    kDist = 0.5\n    aDist distort aOsc, kDist, giSine\n    \n    outs aDist, aDist\nendin\n\ninstr 2\n    ; Variable distortion amount\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.25, 165, 0\n    \n    ; Distortion amount changes over time\n    kDist linseg 0, p3*0.3, 0.8, p3*0.7, 0.2\n    \n    aDist distort aSaw, kDist, giSine\n    \n    outs aDist, aDist\nendin\n\ninstr 3\n    ; Guitar-like distortion\n    kAmp madsr 0.005, 0.08, 0.5, 0.3\n    \n    ; Bright tone\n    aSaw vco2 kAmp*0.3, 110, 0\n    \n    ; Heavy distortion\n    kDist = 0.9\n    aDist distort aSaw, kDist, giSine, 50\n    \n    ; Add some filtering\n    aFilt tone aDist, 3000\n    \n    outs aFilt, aFilt\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic distortion\ni1 0 3\n\n; Play variable distortion\ni2 3.5 5\n\n; Play guitar distortion\ni3 9 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the distort1 opcode for modified waveshaping", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function tables\ngiSine ftgen 1, 0, 8192, 10, 1\ngiDistShape ftgen 2, 0, 257, 7, -1, 128, 0, 129, 1\n\ninstr 1\n    ; distort1 opcode: ares distort1 asig, kpgain, kshape, ifn [, ibufsize]\n    ; distort1 applies modified distortion with pre-gain and shape control\n    ; asig - input audio signal\n    ; kpgain - pre-gain before distortion\n    ; kshape - post-distortion shape amount\n    ; ifn - transfer function table\n    ; ibufsize - buffer size (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Square wave source\n    aSq vco2 kAmp*0.2, 220, 2\n    \n    ; Distort with pre-gain and shaping\n    kPGain = 2      ; Pre-gain\n    kShape = 0.5    ; Shape amount\n    \n    aDist distort1 aSq, kPGain, kShape, giDistShape\n    \n    outs aDist*0.5, aDist*0.5\nendin\n\ninstr 2\n    ; Dynamic distortion character\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.25, 165, 0\n    \n    ; Modulate pre-gain for dynamic distortion\n    kPGain linseg 1, p3, 5\n    kShape = 0.7\n    \n    aDist distort1 aSaw, kPGain, kShape, giDistShape\n    \n    outs aDist*0.4, aDist*0.4\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic distort1\ni1 0 3\n\n; Play dynamic distortion\ni2 3.5 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the powershape opcode for power function waveshaping", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; powershape opcode: ares powershape asig, kShapeAmount [, ifullscale]\n    ; powershape applies power function waveshaping\n    ; asig - input audio signal\n    ; kShapeAmount - shape amount (0 = linear, >0 = compression, <0 = expansion)\n    ; ifullscale - full scale value (optional, default 1)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave\n    aOsc poscil kAmp*0.4, 440, giSine\n    \n    ; Apply power shaping (positive = soft distortion)\n    kShape = 2\n    aShape powershape aOsc, kShape\n    \n    outs aShape, aShape\nendin\n\ninstr 2\n    ; Variable shaping for dynamic timbre\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Triangle-like wave\n    aSaw vco2 kAmp*0.3, 220, 0\n    \n    ; Shape amount varies\n    kShape linseg -2, p3*0.5, 3, p3*0.5, -2\n    \n    aShape powershape aSaw, kShape\n    \n    outs aShape, aShape\nendin\n\ninstr 3\n    ; Compression effect\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Rich harmonic source\n    aSaw vco2 kAmp*0.3, 165, 0\n    \n    ; Positive shape = compression/softening\n    kShape = 5\n    aShape powershape aSaw, kShape\n    \n    outs aShape, aShape\nendin\n\ninstr 4\n    ; Expansion for harder sound\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Square wave\n    aSq vco2 kAmp*0.25, 110, 2\n    \n    ; Negative shape = expansion/hardening\n    kShape = -1.5\n    aShape powershape aSq, kShape\n    \n    outs aShape, aShape\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play soft distortion\ni1 0 3\n\n; Play variable shaping\ni2 3.5 5\n\n; Play compression\ni3 9 3\n\n; Play expansion\ni4 12.5 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the polynomial opcode for polynomial waveshaping", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; polynomial opcode: ares polynomial asig, k0, k1, k2, k3, ..., kN\n    ; polynomial applies polynomial waveshaping: out = k0 + k1*in + k2*in^2 + k3*in^3 + ...\n    ; asig - input audio signal\n    ; k0, k1, k2, ... - polynomial coefficients\n    ; Can have up to 10 coefficients\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave input\n    aOsc poscil kAmp*0.4, 220, giSine\n    \n    ; Polynomial: 0 + 1*x + 0.5*x^3 (adds 3rd harmonic)\n    aPoly polynomial aOsc, 0, 1, 0, 0.5\n    \n    outs aPoly*0.5, aPoly*0.5\nendin\n\ninstr 2\n    ; Odd harmonics only (square-like)\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sine input\n    aOsc poscil kAmp*0.3, 165, giSine\n    \n    ; Polynomial with odd terms: x + 0.3*x^3 + 0.1*x^5\n    aPoly polynomial aOsc, 0, 1, 0, 0.3, 0, 0.1\n    \n    outs aPoly*0.5, aPoly*0.5\nendin\n\ninstr 3\n    ; Even harmonics (octave up effect)\n    kAmp linseg 0, 0.05, 0.3, p3-0.1, 0.3, 0.05, 0\n    \n    ; Sine input\n    aOsc poscil kAmp*0.4, 220, giSine\n    \n    ; Even terms only: 0.5*x^2\n    aPoly polynomial aOsc, 0, 0, 0.5\n    \n    outs aPoly*0.5, aPoly*0.5\nendin\n\ninstr 4\n    ; Complex harmonic structure\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Sine input\n    aOsc poscil kAmp*0.3, 330, giSine\n    \n    ; Rich polynomial: x + 0.3*x^2 + 0.2*x^3 + 0.1*x^4\n    aPoly polynomial aOsc, 0, 1, 0.3, 0.2, 0.1\n    \n    outs aPoly*0.4, aPoly*0.4\nendin\n\ninstr 5\n    ; Time-varying polynomial coefficients\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sine input\n    aOsc poscil kAmp*0.3, 220, giSine\n    \n    ; Modulate 3rd harmonic amount\n    kK3 linseg 0, p3, 1\n    \n    aPoly polynomial aOsc, 0, 1, 0, kK3\n    \n    outs aPoly*0.5, aPoly*0.5\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play 3rd harmonic\ni1 0 3\n\n; Play odd harmonics\ni2 3.5 3\n\n; Play even harmonics\ni3 7 3\n\n; Play complex\ni4 10.5 3\n\n; Play time-varying\ni5 14 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the chebyshevpoly opcode for Chebyshev polynomial waveshaping", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; chebyshevpoly opcode: ares chebyshevpoly asig, k0, k1, k2, k3, ..., kN\n    ; chebyshevpoly applies Chebyshev polynomial waveshaping\n    ; Each coefficient kN corresponds to the Nth harmonic\n    ; asig - input audio signal (should be normalized -1 to 1)\n    ; k0, k1, k2, ... - Chebyshev polynomial coefficients\n    ; k1 = fundamental, k2 = 2nd harmonic, k3 = 3rd harmonic, etc.\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave input (normalized)\n    aOsc poscil kAmp*0.8, 220, giSine\n    \n    ; Add harmonics: fundamental + 3rd + 5th\n    aCheb chebyshevpoly aOsc, 0, 0.5, 0, 0.3, 0, 0.2\n    \n    outs aCheb*0.4, aCheb*0.4\nendin\n\ninstr 2\n    ; Brass-like spectrum\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sine input\n    aOsc poscil kAmp*0.8, 165, giSine\n    \n    ; Brass spectrum: strong fundamental and harmonics\n    aCheb chebyshevpoly aOsc, 0, 1, 0.3, 0.2, 0.15, 0.1, 0.08, 0.06\n    \n    outs aCheb*0.3, aCheb*0.3\nendin\n\ninstr 3\n    ; Square-like (odd harmonics)\n    kAmp linseg 0, 0.05, 0.3, p3-0.1, 0.3, 0.05, 0\n    \n    ; Sine input\n    aOsc poscil kAmp*0.8, 330, giSine\n    \n    ; Odd harmonics only\n    aCheb chebyshevpoly aOsc, 0, 0.8, 0, 0.4, 0, 0.2, 0, 0.1\n    \n    outs aCheb*0.4, aCheb*0.4\nendin\n\ninstr 4\n    ; Clarinet-like (missing even harmonics)\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Sine input\n    aOsc poscil kAmp*0.8, 220, giSine\n    \n    ; Clarinet spectrum\n    aCheb chebyshevpoly aOsc, 0, 1, 0, 0.7, 0, 0.4, 0, 0.2, 0, 0.1\n    \n    outs aCheb*0.35, aCheb*0.35\nendin\n\ninstr 5\n    ; Dynamic harmonic content\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sine input\n    aOsc poscil kAmp*0.8, 165, giSine\n    \n    ; Envelope controls harmonic brightness\n    kBright madsr 0.05, 0.3, 0.2, 0.1\n    kBright = kBright * 0.5\n    \n    ; More harmonics as brightness increases\n    aCheb chebyshevpoly aOsc, 0, 1, kBright*0.5, kBright*0.7, kBright*0.4, kBright*0.3\n    \n    outs aCheb*0.35, aCheb*0.35\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play odd harmonics\ni1 0 3\n\n; Play brass\ni2 3.5 3\n\n; Play square-like\ni3 7 3\n\n; Play clarinet\ni4 10.5 3\n\n; Play dynamic\ni5 14 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the pdclip opcode for clipping distortion", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; pdclip opcode: ares pdclip asig, kwidth, kcenter [, ifullscale] [, ifn]\n    ; pdclip performs clipping distortion\n    ; asig - input audio signal\n    ; kwidth - clipping width (0-1, smaller = harder clipping)\n    ; kcenter - center point of clipping (0-1)\n    ; ifullscale - full scale value (optional)\n    ; ifn - transfer function (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave\n    aOsc poscil kAmp*0.6, 220, giSine\n    \n    ; Soft clipping\n    kWidth = 0.5\n    kCenter = 0.5\n    \n    aClip pdclip aOsc, kWidth, kCenter\n    \n    outs aClip*0.5, aClip*0.5\nendin\n\ninstr 2\n    ; Hard clipping for distortion\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.5, 165, 0\n    \n    ; Hard clipping (narrow width)\n    kWidth = 0.2\n    kCenter = 0.5\n    \n    aClip pdclip aSaw, kWidth, kCenter\n    \n    outs aClip*0.4, aClip*0.4\nendin\n\ninstr 3\n    ; Asymmetric clipping\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Square wave\n    aSq vco2 kAmp*0.5, 110, 2\n    \n    ; Off-center clipping for asymmetry\n    kWidth = 0.4\n    kCenter = 0.3  ; Off-center\n    \n    aClip pdclip aSq, kWidth, kCenter\n    \n    outs aClip*0.4, aClip*0.4\nendin\n\ninstr 4\n    ; Dynamic clipping amount\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Sine wave\n    aOsc poscil kAmp*0.6, 330, giSine\n    \n    ; Modulate clipping width\n    kWidth linseg 0.8, p3, 0.1\n    kCenter = 0.5\n    \n    aClip pdclip aOsc, kWidth, kCenter\n    \n    outs aClip*0.4, aClip*0.4\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play soft clipping\ni1 0 3\n\n; Play hard clipping\ni2 3.5 3\n\n; Play asymmetric\ni3 7 3\n\n; Play dynamic\ni4 10.5 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the pdhalfy opcode for half-wave rectification", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; pdhalfy opcode: ares pdhalfy asig, kamount [, ibipolar]\n    ; pdhalfy performs half-wave rectification (adds harmonics)\n    ; asig - input audio signal\n    ; kamount - rectification amount (0 = no effect, 1 = full rectification)\n    ; ibipolar - bipolar mode flag (optional, default 0)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave\n    aOsc poscil kAmp*0.4, 220, giSine\n    \n    ; Half-wave rectification\n    kAmount = 0.7\n    \n    aHalfy pdhalfy aOsc, kAmount\n    \n    outs aHalfy, aHalfy\nendin\n\ninstr 2\n    ; Full rectification for harmonic richness\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sine wave\n    aOsc poscil kAmp*0.4, 165, giSine\n    \n    ; Full rectification\n    kAmount = 1\n    \n    aHalfy pdhalfy aOsc, kAmount\n    \n    outs aHalfy, aHalfy\nendin\n\ninstr 3\n    ; Variable rectification\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Triangle-like wave\n    aSaw vco2 kAmp*0.3, 330, 0\n    \n    ; Amount varies over time\n    kAmount linseg 0, p3, 1\n    \n    aHalfy pdhalfy aSaw, kAmount\n    \n    outs aHalfy, aHalfy\nendin\n\ninstr 4\n    ; Bipolar rectification\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Sine wave\n    aOsc poscil kAmp*0.4, 220, giSine\n    \n    ; Bipolar mode\n    kAmount = 0.8\n    iBipolar = 1\n    \n    aHalfy pdhalfy aOsc, kAmount, iBipolar\n    \n    outs aHalfy, aHalfy\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play half rectification\ni1 0 3\n\n; Play full rectification\ni2 3.5 3\n\n; Play variable\ni3 7 4\n\n; Play bipolar\ni4 11.5 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the tanh opcode for hyperbolic tangent distortion", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; tanh opcode: ares tanh asig [, kmode]\n    ; tanh applies hyperbolic tangent waveshaping (smooth saturation)\n    ; asig - input audio signal\n    ; kmode - mode flag (optional, 0=bipolar, 1=unipolar)\n    ; tanh provides smooth, analog-like saturation\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave with boost for saturation\n    aOsc poscil kAmp*2, 220, giSine\n    \n    ; Apply tanh saturation\n    aSat tanh aOsc\n    \n    outs aSat*0.4, aSat*0.4\nendin\n\ninstr 2\n    ; Tube-like saturation\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*1.5, 165, 0\n    \n    ; Tanh for smooth saturation\n    aSat tanh aSaw\n    \n    ; Add some filtering for warmth\n    aWarm tone aSat, 3000\n    \n    outs aWarm*0.4, aWarm*0.4\nendin\n\ninstr 3\n    ; Variable drive amount\n    kAmp linseg 0, 0.05, 0.3, p3-0.1, 0.3, 0.05, 0\n    \n    ; Square wave\n    aSq vco2 kAmp, 110, 2\n    \n    ; Variable pre-gain for drive control\n    kDrive linseg 1, p3, 5\n    aSat tanh aSq*kDrive\n    \n    outs aSat*0.35, aSat*0.35\nendin\n\ninstr 4\n    ; Soft limiter using tanh\n    kAmp madsr 0.005, 0.08, 0.5, 0.3\n    \n    ; Multiple detuned saws (can get loud)\n    aSaw1 vco2 kAmp*0.4, 220, 0\n    aSaw2 vco2 kAmp*0.4, 220.5, 0\n    aSaw3 vco2 kAmp*0.4, 221, 0\n    aMix = aSaw1 + aSaw2 + aSaw3\n    \n    ; Tanh acts as soft limiter\n    aLimit tanh aMix*2\n    \n    outs aLimit*0.4, aLimit*0.4\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic saturation\ni1 0 3\n\n; Play tube saturation\ni2 3.5 3\n\n; Play variable drive\ni3 7 5\n\n; Play soft limiting\ni4 12.5 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the limit opcode for hard limiting", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; limit opcode: ares limit asig, klow, khigh\n    ; limit clips signal to a specified range\n    ; asig - input audio signal\n    ; klow - lower limit\n    ; khigh - upper limit\n    ; Creates hard clipping at the specified thresholds\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave (boosted)\n    aOsc poscil kAmp*0.8, 220, giSine\n    \n    ; Hard limit\n    kLow = -0.3\n    kHigh = 0.3\n    \n    aLim limit aOsc, kLow, kHigh\n    \n    outs aLim, aLim\nendin\n\ninstr 2\n    ; Extreme limiting for distortion\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.5, 165, 0\n    \n    ; Very tight limits\n    kLow = -0.1\n    kHigh = 0.1\n    \n    aLim limit aSaw, kLow, kHigh\n    \n    outs aLim*2, aLim*2\nendin\n\ninstr 3\n    ; Asymmetric limiting\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Square wave\n    aSq vco2 kAmp*0.5, 110, 2\n    \n    ; Asymmetric limits\n    kLow = -0.4\n    kHigh = 0.2\n    \n    aLim limit aSq, kLow, kHigh\n    \n    outs aLim*0.8, aLim*0.8\nendin\n\ninstr 4\n    ; Dynamic threshold\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Rich harmonic source\n    aSaw vco2 kAmp*0.6, 220, 0\n    \n    ; Limits vary over time\n    kThresh linseg 0.5, p3, 0.05\n    \n    aLim limit aSaw, -kThresh, kThresh\n    \n    outs aLim*0.6, aLim*0.6\nendin\n\ninstr 5\n    ; Protection limiter\n    kAmp madsr 0.005, 0.08, 0.5, 0.3\n    \n    ; Multiple oscillators\n    aOsc1 poscil kAmp*0.3, 220, giSine\n    aOsc2 poscil kAmp*0.3, 330, giSine\n    aOsc3 poscil kAmp*0.3, 440, giSine\n    aMix = aOsc1 + aOsc2 + aOsc3\n    \n    ; Limit to prevent clipping\n    kLow = -0.8\n    kHigh = 0.8\n    \n    aLim limit aMix, kLow, kHigh\n    \n    outs aLim, aLim\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic limiting\ni1 0 3\n\n; Play extreme limiting\ni2 3.5 3\n\n; Play asymmetric\ni3 7 3\n\n; Play dynamic threshold\ni4 10.5 4\n\n; Play protection\ni5 15 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates combining multiple waveshaping techniques", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function tables\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; Chained waveshaping: Chebyshev -> tanh -> limit\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sine wave input\n    aOsc poscil kAmp*0.8, 220, giSine\n    \n    ; First: Add harmonics with Chebyshev\n    aCheb chebyshevpoly aOsc, 0, 1, 0.3, 0.2, 0.15\n    \n    ; Second: Smooth saturation with tanh\n    aSat tanh aCheb*2\n    \n    ; Third: Final safety limiting\n    aOut limit aSat, -0.9, 0.9\n    \n    outs aOut*0.4, aOut*0.4\nendin\n\ninstr 2\n    ; Parallel processing\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.3, 165, 0\n    \n    ; Path 1: Clean with slight shaping\n    aClean powershape aSaw, 1\n    \n    ; Path 2: Heavy distortion\n    aHeavy pdclip aSaw*2, 0.2, 0.5\n    \n    ; Path 3: Soft saturation\n    aSoft tanh aSaw*1.5\n    \n    ; Mix paths\n    aMix = aClean*0.4 + aHeavy*0.3 + aSoft*0.3\n    \n    outs aMix*0.5, aMix*0.5\nendin\n\ninstr 3\n    ; Dynamic waveshaping chain\n    kAmp linseg 0, 0.3, 0.3, p3-0.6, 0.3, 0.3, 0\n    \n    ; Sine input\n    aOsc poscil kAmp*0.8, 110, giSine\n    \n    ; Envelope controls distortion amount\n    kEnv madsr 0.05, 0.3, 0.3, 0.2\n    \n    ; Polynomial with dynamic coefficients\n    aPoly polynomial aOsc, 0, 1, kEnv*0.5, kEnv*0.3\n    \n    ; Drive amount changes\n    kDrive = 1 + kEnv*3\n    aTanh tanh aPoly*kDrive\n    \n    ; Dynamic limiting\n    kThresh = 0.9 - kEnv*0.4\n    aOut limit aTanh, -kThresh, kThresh\n    \n    outs aOut*0.4, aOut*0.4\nendin\n\ninstr 4\n    ; Guitar amp simulation\n    kAmp madsr 0.005, 0.08, 0.5, 0.3\n    \n    ; Bright tone\n    aSaw vco2 kAmp*0.3, 220, 0\n    \n    ; Stage 1: Pre-gain and compression\n    aStage1 powershape aSaw*2, 2\n    \n    ; Stage 2: Tube-like saturation\n    aStage2 tanh aStage1*1.8\n    \n    ; Stage 3: Output clipping\n    aStage3 pdclip aStage2, 0.4, 0.5\n    \n    ; Stage 4: Tone stack (simple filter)\n    aTone tone aStage3, 2500\n    \n    ; Stage 5: Final limiter\n    aOut limit aTone, -0.85, 0.85\n    \n    outs aOut*0.5, aOut*0.5\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play chained\ni1 0 4\n\n; Play parallel\ni2 4.5 4\n\n; Play dynamic\ni3 9 6\n\n; Play amp sim\ni4 16 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
