{"instruction": "Write a CSound instrument that demonstrates stereo and multi-channel processing opcodes: pan, space, spat3d, bformenc", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; Basic stereo width control\n    ; Mono to stereo with variable width\n    \n    aIn oscili 0.3, 440, -1\n    \n    ; Width control (0=mono, 1=normal stereo, >1=wide)\n    kWidth linseg 0, p3*0.33, 1, p3*0.33, 2, p3*0.34, 0.5\n    \n    ; Create stereo image\n    aMid = aIn\n    aSide = aIn * 0.5  ; Decorrelated side signal (simplified)\n    \n    ; M-S encoding\n    aLeft = aMid + aSide*kWidth\n    aRight = aMid - aSide*kWidth\n    \n    outs aLeft, aRight\nendin\n\ninstr 2\n    ; Mid-side processing\n    ; Process mid and side separately\n    \n    ; Stereo input (simulated)\n    aL vco2 0.3, 220, 0\n    aR vco2 0.3, 330, 10\n    \n    ; Convert to mid-side\n    aMid = (aL + aR) * 0.5\n    aSide = (aL - aR) * 0.5\n    \n    ; Process mid and side independently\n    aMid butterlp aMid, 2000\n    aSide butterhp aSide, 500\n    aSide *= 1.5  ; Enhance stereo width\n    \n    ; Convert back to L-R\n    aOutL = aMid + aSide\n    aOutR = aMid - aSide\n    \n    outs aOutL, aOutR\nendin\n\ninstr 3\n    ; Haas effect (precedence effect)\n    ; Create stereo width through short delays\n    \n    aIn buzz 0.3, 330, 20, -1\n    \n    ; Short delay on one channel (1-30ms)\n    kDelay linseg 0.001, p3*0.5, 0.025, p3*0.5, 0.005\n    \n    aDelL delayr 0.05\n    aTapL deltapi kDelay\n          delayw aIn\n    \n    ; Left channel delayed, right is dry\n    aLeft = aTapL\n    aRight = aIn\n    \n    outs aLeft, aRight\nendin\n\ninstr 4\n    ; Pseudo-stereo from mono\n    ; Create stereo image using filtering\n    \n    aIn vco2 0.3, 220, 10\n    \n    ; Different filtering for each channel\n    aLeft butterlp aIn, 3000\n    aLeft += butterbp(aIn, 1200, 400) * 0.5\n    \n    aRight butterhp aIn, 800\n    aRight += butterbp(aIn, 1800, 500) * 0.5\n    \n    ; Add slight delay difference\n    aDelL delayr 0.02\n    aTapL deltapi 0.007\n          delayw aLeft\n    \n    aDelR delayr 0.02\n    aTapR deltapi 0.011\n          delayw aRight\n    \n    outs aTapL, aTapR\nendin\n\ninstr 5\n    ; Stereo chorus for width\n    ; Different modulation for L and R\n    \n    aIn oscili 0.3, 440, -1\n    \n    ; LFOs with different rates and phases\n    kLFO_L lfo 0.003, 0.7, 0\n    kLFO_R lfo 0.003, 0.53, 0.25  ; Phase offset\n    \n    ; Variable delays\n    aDelL delayr 0.05\n    aTapL deltapi 0.015 + kLFO_L\n          delayw aIn\n    \n    aDelR delayr 0.05\n    aTapR deltapi 0.018 + kLFO_R\n          delayw aIn\n    \n    ; Mix with dry\n    aLeft = aIn*0.6 + aTapL*0.4\n    aRight = aIn*0.6 + aTapR*0.4\n    \n    outs aLeft, aRight\nendin\n\ninstr 6\n    ; Stereo imaging with phase manipulation\n    ; Using allpass filters for phase shifting\n    \n    aIn vco2 0.3, 330, 0\n    \n    ; Left channel - original phase\n    aLeft = aIn\n    \n    ; Right channel - phase shifted\n    aRight phaser1 aIn, 800, 4, 0.5\n    \n    ; Balance levels\n    aLeft *= 0.9\n    aRight *= 0.9\n    \n    outs aLeft, aRight\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 3\ni3 9 3\ni4 13 4\ni5 18 4\ni6 23 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
