{"instruction": "Write a CSound instrument that demonstrates bin processing opcodes: pvsbin, pvsbinread, pvsinfo, pvscent", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; pvsbin opcode: kamp, kfr pvsbin fsig, kbin\n    ; Read amplitude and frequency of individual bin\n    ; kbin - bin number to read\n    \n    aIn buzz 0.3, 220, 20, -1\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Read specific bin (around fundamental)\n    kBin = 5  ; Bin 5 â‰ˆ 215 Hz (sr/N * bin)\n    kAmp, kFr pvsbin fsig, kBin\n    \n    ; Use bin data to control synthesis\n    aOsc oscili kAmp*8, kFr, -1\n    \n    ; Also synthesize original\n    aOrig pvsynth fsig\n    \n    outs aOrig*0.4, aOsc*0.6\nendin\n\ninstr 2\n    ; Multiple bin reading\n    ; Track several bins simultaneously\n    \n    aIn vco2 0.3, 165, 0\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Read multiple bins\n    kAmp1, kFr1 pvsbin fsig, 4   ; Fundamental region\n    kAmp2, kFr2 pvsbin fsig, 8   ; Second harmonic region\n    kAmp3, kFr3 pvsbin fsig, 12  ; Third harmonic region\n    \n    ; Synthesize from bin data\n    aOsc1 oscili kAmp1*5, kFr1, -1\n    aOsc2 oscili kAmp2*5, kFr2, -1\n    aOsc3 oscili kAmp3*5, kFr3, -1\n    \n    aMix = (aOsc1 + aOsc2 + aOsc3) * 0.4\n    \n    ; Original\n    aOrig pvsynth fsig\n    \n    outs aOrig*0.4, aMix*0.6\nendin\n\ninstr 3\n    ; pvsinfo opcode: iolaps, iwinsize, iformat pvsinfo ifn\n    ; Get information about PVS signal\n    ; Note: This is i-rate, informational\n    \n    aIn buzz 0.3, 330, 15, -1\n    \n    ; Analyze with specific parameters\n    fsig pvsanal aIn, 2048, 512, 2048, 1\n    \n    ; In practice, pvsinfo would tell us:\n    ; - Number of overlaps\n    ; - Window size\n    ; - Format\n    \n    ; Synthesize\n    aOut pvsynth fsig\n    \n    outs aOut, aOut\nendin\n\ninstr 4\n    ; pvscent opcode: kcent pvscent fsig\n    ; Calculate spectral centroid\n    \n    aIn vco2 0.3, 220, 10\n    aIn *= linseg(1, p3*0.5, 0.3, p3*0.5, 1)\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Get centroid\n    kCent pvscent fsig\n    \n    ; Use centroid to control filter\n    aOrig pvsynth fsig\n    aFilt butterlp aOrig, kCent*3\n    \n    outs aOrig*0.5, aFilt*0.5\nendin\n\ninstr 5\n    ; Bin manipulation\n    ; Read, modify, and resynthesize specific bins\n    \n    aIn vco2 0.3, 165, 0\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Read and track fundamental bin\n    kBin = 4\n    kAmp, kFr pvsbin fsig, kBin\n    \n    ; Modify frequency (detune)\n    kFrMod = kFr * 1.02\n    \n    ; Create modified tone\n    aOrig pvsynth fsig\n    aModified oscili kAmp*6, kFrMod, -1\n    \n    outs aOrig*0.4, aModified*0.6\nendin\n\ninstr 6\n    ; Spectral analysis using bins\n    ; Detect strongest bins\n    \n    aIn buzz 0.3, 110, 30, -1\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Sample several bins to find peaks\n    kAmp1, kFr1 pvsbin fsig, 2\n    kAmp2, kFr2 pvsbin fsig, 4\n    kAmp3, kFr3 pvsbin fsig, 6\n    kAmp4, kFr4 pvsbin fsig, 8\n    \n    ; Find strongest\n    kMaxAmp max kAmp1, kAmp2, kAmp3, kAmp4\n    \n    ; Use for dynamics control\n    aOrig pvsynth fsig\n    aOut = aOrig * (1 + kMaxAmp*2)\n    aOut *= 0.4\n    \n    outs aOrig*0.5, aOut*0.5\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 4 3\ni3 8 2\ni4 11 4\ni5 16 3\ni6 20 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
