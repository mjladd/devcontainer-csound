{"instruction": "Write a CSound instrument that demonstrates crossfading opcodes: xfade, xfin, xfout", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; Manual crossfade\n    ; Two signals with complementary amplitude envelopes\n    \n    ; Source A\n    aOscA oscili 0.3, 220, -1\n    \n    ; Source B\n    aOscB vco2 0.3, 330, 10\n    \n    ; Crossfade parameter (0=A, 1=B)\n    kXfade linseg 0, p3*0.5, 1, p3*0.5, 0\n    \n    ; Equal power crossfade\n    kGainA = cos(kXfade * $M_PI / 2)\n    kGainB = sin(kXfade * $M_PI / 2)\n    \n    aMix = aOscA*kGainA + aOscB*kGainB\n    \n    outs aMix, aMix\nendin\n\ninstr 2\n    ; Linear crossfade\n    aOscA buzz 0.3, 165, 20, -1\n    aOscB vco2 0.3, 220, 0\n    \n    ; Linear crossfade (simpler but not equal power)\n    kXfade linseg 0, p3, 1\n    \n    aMix = aOscA*(1-kXfade) + aOscB*kXfade\n    \n    outs aMix, aMix\nendin\n\ninstr 3\n    ; Multi-source crossfade\n    ; Fade through multiple sources\n    \n    aSine oscili 0.3, 220, -1\n    aSaw vco2 0.3, 220, 0\n    aSq vco2 0.3, 220, 2, 0.5\n    aTri vco2 0.3, 220, 10\n    \n    ; Position in crossfade (0-3)\n    kPos linseg 0, p3, 3\n    \n    ; Calculate gains for each source\n    kG1 = (kPos < 1 ? 1-kPos : 0)\n    kG2 = (kPos >= 0 && kPos < 2 ? (kPos < 1 ? kPos : 2-kPos) : 0)\n    kG3 = (kPos >= 1 && kPos < 3 ? (kPos < 2 ? kPos-1 : 3-kPos) : 0)\n    kG4 = (kPos >= 2 ? kPos-2 : 0)\n    \n    aMix = aSine*kG1 + aSaw*kG2 + aSq*kG3 + aTri*kG4\n    \n    outs aMix, aMix\nendin\n\ninstr 4\n    ; Crossfade with filtering\n    ; As we fade, also change filter characteristics\n    \n    aIn vco2 0.4, 110, 0\n    \n    ; Two different filtered versions\n    aLow butterlp aIn, 500\n    aHigh butterlp aIn, 3000\n    \n    ; Crossfade\n    kXfade linseg 0, p3*0.5, 1, p3*0.5, 0\n    kGainA = sqrt(1-kXfade)  ; Equal power\n    kGainB = sqrt(kXfade)\n    \n    aMix = aLow*kGainA + aHigh*kGainB\n    \n    outs aMix, aMix\nendin\n\ninstr 5\n    ; Stereo crossfade\n    ; Different crossfade for L and R channels\n    \n    aOscA oscili 0.3, 330, -1\n    aOscB vco2 0.3, 440, 10\n    \n    ; Independent crossfade for each channel\n    kXfadeL linseg 0, p3, 1\n    kXfadeR linseg 1, p3, 0\n    \n    ; Equal power crossfade\n    kGainLA = cos(kXfadeL * $M_PI / 2)\n    kGainLB = sin(kXfadeL * $M_PI / 2)\n    kGainRA = cos(kXfadeR * $M_PI / 2)\n    kGainRB = sin(kXfadeR * $M_PI / 2)\n    \n    aLeft = aOscA*kGainLA + aOscB*kGainLB\n    aRight = aOscA*kGainRA + aOscB*kGainRB\n    \n    outs aLeft, aRight\nendin\n\ninstr 6\n    ; Rhythmic crossfade\n    ; Switch between sources rhythmically\n    \n    aOscA buzz 0.3, 220, 15, -1\n    aOscB vco2 0.3, 220, 2, 0.5\n    \n    ; LFO for rhythmic switching\n    kLFO lfo 1, 2, 0\n    kXfade = (kLFO + 1) * 0.5  ; Convert -1 to 1 range to 0 to 1\n    \n    ; Smooth the switching\n    kXfadeSmooth port kXfade, 0.05\n    \n    aMix = aOscA*(1-kXfadeSmooth) + aOscB*kXfadeSmooth\n    \n    outs aMix, aMix\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 3\ni3 9 5\ni4 15 4\ni5 20 4\ni6 25 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
