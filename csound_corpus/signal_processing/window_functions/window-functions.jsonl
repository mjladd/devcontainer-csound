{"instruction": "Write a CSound instrument that demonstrates window functions: window, pvscent for windowed analysis", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Window function tables\ngiHamming ftgen 0, 0, 8192, 20, 2, 1  ; Hamming window\ngiHanning ftgen 0, 0, 8192, 20, 1, 1  ; Hanning window\ngiBlackman ftgen 0, 0, 8192, 20, 3, 1 ; Blackman window\n\ninstr 1\n    ; window opcode: ares window asig, koff [, itype] [, ifn]\n    ; Apply window function to signal\n    ; koff - offset into window\n    ; itype - window type\n    ; ifn - window function table\n    \n    aIn buzz 0.3, 220, 20, -1\n    \n    ; Apply Hamming window\n    kOff linseg 0, p3, 1\n    aWindowed window aIn, kOff, 0, giHamming\n    \n    outs aIn*0.5, aWindowed*0.5\nendin\n\ninstr 2\n    ; Different window types comparison\n    aIn vco2 0.3, 330, 0\n    \n    ; Offset sweeps through window\n    kOff lfo 0.5, 1, 0\n    kOff = (kOff + 1) * 0.5  ; 0 to 1\n    \n    ; Apply Hanning window\n    aWindowed window aIn, kOff, 0, giHanning\n    \n    outs aIn*0.4, aWindowed*0.6\nendin\n\ninstr 3\n    ; pvscent with windowing\n    ; Spectral centroid calculation\n    \n    aIn buzz 0.3, 165, 30, -1\n    aIn *= linseg(1, p3*0.5, 0.4, p3*0.5, 1)\n    \n    ; Analyze with window\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Calculate centroid\n    kCent pvscent fsig\n    \n    ; Use centroid for filter control\n    aFilt butterlp aIn, kCent*2.5\n    \n    outs aIn*0.4, aFilt*0.6\nendin\n\ninstr 4\n    ; Windowed granular effect\n    ; Apply window to short segments\n    \n    aIn vco2 0.4, 220, 10\n    \n    ; Grain window\n    kGrainRate = 20\n    kPhase phasor kGrainRate\n    \n    ; Apply window to create grains\n    aGrain window aIn, kPhase, 0, giHanning\n    \n    outs aIn*0.3, aGrain*0.7\nendin\n\ninstr 5\n    ; Blackman window for analysis\n    aIn buzz 0.3, 110, 40, -1\n    \n    ; Sweep offset\n    kOff linseg 0, p3, 1\n    \n    ; Apply Blackman window (better frequency resolution)\n    aWindowed window aIn, kOff, 0, giBlackman\n    \n    ; Analyze windowed signal\n    fsig pvsanal aWindowed, 2048, 512, 2048, 1\n    \n    ; Get centroid\n    kCent pvscent fsig\n    \n    ; Synthesize\n    aOut pvsynth fsig\n    \n    outs aIn*0.3, aOut*0.7\nendin\n\ninstr 6\n    ; Dynamic window selection\n    ; Switch between window types\n    \n    aIn vco2 0.3, 165, 0\n    \n    kOff linseg 0, p3, 1\n    \n    ; Select window based on time\n    kWinType linseg 0, p3*0.33, 1, p3*0.33, 2, p3*0.34, 0\n    \n    ; Apply appropriate window\n    iFn = (kWinType < 0.5 ? giHamming : \\\n          (kWinType < 1.5 ? giHanning : giBlackman))\n    \n    aWindowed window aIn, kOff, 0, iFn\n    \n    outs aIn*0.4, aWindowed*0.6\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 4 4\ni3 9 4\ni4 14 3\ni5 18 4\ni6 23 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
