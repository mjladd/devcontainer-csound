{"instruction": "Write a CSound instrument that demonstrates FFT phase vocoder opcodes: pvstencil, pvsmaska, pvsbufread2", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; pvstencil opcode: fsig pvstencil fsigin, kgain, klevel, iftable\n    ; Spectral gating using a function table as mask\n    ; kgain - overall gain\n    ; klevel - threshold level\n    ; iftable - function table containing the stencil\n    \n    ; Source signal\n    aIn buzz 0.3, 220, 20, -1\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Create simple stencil - keep only certain frequency regions\n    ; Table with 512 points (half of FFT size)\n    giStencil ftgen 0, 0, 512, 7, 0, 100, 0, 50, 1, 100, 1, 50, 0.5, 100, 0.5, 112, 0\n    \n    ; Apply stencil\n    fres pvstencil fsig, 1, 0.1, giStencil\n    \n    ; Synthesize\n    aOut pvsynth fres\n    \n    outs aOut, aOut\nendin\n\ninstr 2\n    ; pvsmaska opcode: fsig pvsmaska fsig, fmask, kdepth\n    ; Apply spectral masking using another spectrum\n    ; fmask - masking spectrum\n    ; kdepth - masking depth (0-1)\n    \n    ; Main signal\n    aMain vco2 0.3, 330, 0\n    \n    ; Mask signal (noise)\n    aMask rand 0.2\n    \n    ; Analyze both\n    fMain pvsanal aMain, 1024, 256, 1024, 1\n    fMask pvsanal aMask, 1024, 256, 1024, 1\n    \n    ; Apply masking with variable depth\n    kDepth linseg 0, p3*0.5, 0.9, p3*0.5, 0\n    fres pvsmaska fMain, fMask, kDepth\n    \n    ; Synthesize\n    aOut pvsynth fres\n    \n    outs aOut, aOut\nendin\n\ninstr 3\n    ; pvsbufread2 opcode: fsig pvsbufread2 ktime, khandle [, iunit, iinterp]\n    ; Read from a buffer at specific time\n    ; ktime - time position to read\n    ; khandle - buffer handle\n    ; iunit - time units (0=seconds, 1=sample frames)\n    ; iinterp - interpolation (0=off, 1=on)\n    \n    ; Create a buffer with some sound\n    ; In practice, this would be loaded from a file\n    aSource vco2 0.3, 220, 10\n    aSource *= linseg(1, p3*0.5, 0.5, p3*0.5, 1)\n    \n    ; Analyze and buffer\n    fsig pvsanal aSource, 1024, 256, 1024, 1\n    \n    ; Buffer for 2 seconds\n    khandle pvsbuffer fsig, 2\n    \n    ; Read from buffer with time scrubbing\n    kTime linseg 0, p3, 1.5\n    fread pvsbufread2 kTime, khandle\n    \n    ; Synthesize\n    aOut pvsynth fread\n    \n    outs aOut, aOut\nendin\n\ninstr 4\n    ; Combining multiple PVS operations\n    aIn buzz 0.25, 165, 15, -1\n    \n    ; Analyze\n    fsig pvsanal aIn, 2048, 512, 2048, 1\n    \n    ; Create mask table\n    giMask2 ftgen 0, 0, 1024, 7, 1, 200, 1, 100, 0.3, 300, 0.3, 424, 1\n    \n    ; Apply stencil\n    fstenc pvstencil fsig, 1.2, 0.05, giMask2\n    \n    ; Synthesize\n    aOut pvsynth fstenc\n    \n    outs aOut, aOut\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 4\ni3 10 3\ni4 14 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates advanced phase vocoder opcodes: pvsdemix, pvsvoc, pvslock, pvsbin, pvscent", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; pvsdemix opcode: fsig1, fsig2 pvsdemix fsigin, fsigmask, kdepth, kgain\n    ; Spectral source separation\n    ; fsigmask - mask spectrum\n    ; kdepth - separation depth\n    ; kgain - overall gain\n    \n    ; Mixed signal (harmonic + noise)\n    aHarm buzz 0.2, 220, 15, -1\n    aNoise rand 0.15\n    aMix = aHarm + aNoise\n    \n    ; Analyze\n    fMix pvsanal aMix, 1024, 256, 1024, 1\n    fNoise pvsanal aNoise, 1024, 256, 1024, 1\n    \n    ; Demix\n    fHarmonic, fResidual pvsdemix fMix, fNoise, 0.7, 1\n    \n    ; Synthesize separated components\n    aOutHarm pvsynth fHarmonic\n    aOutResid pvsynth fResidual\n    \n    ; Pan separated sources\n    outs aOutHarm*0.8, aOutResid*0.8\nendin\n\ninstr 2\n    ; pvsvoc opcode: fsig pvsvoc famp, ffr, kdepth [, kgain] [,kcoefs]\n    ; Classic phase vocoder cross-synthesis\n    ; famp - amplitude spectrum source\n    ; ffr - frequency spectrum source\n    ; kdepth - cross-synthesis depth\n    \n    ; Two sources\n    aOsc1 buzz 0.25, 330, 20, -1\n    aOsc2 vco2 0.25, 110, 0\n    \n    ; Analyze\n    fAmp pvsanal aOsc1, 1024, 256, 1024, 1\n    fFreq pvsanal aOsc2, 1024, 256, 1024, 1\n    \n    ; Cross-synthesize\n    kDepth linseg 0, p3*0.3, 1, p3*0.4, 1, p3*0.3, 0\n    fvoc pvsvoc fAmp, fFreq, kDepth\n    \n    ; Synthesize\n    aOut pvsynth fvoc\n    \n    outs aOut, aOut\nendin\n\ninstr 3\n    ; pvslock opcode: fsig pvslock fsigin, klock\n    ; Lock phases for cleaner spectral processing\n    ; klock - lock factor (0-1)\n    \n    aIn vco2 0.3, 220, 0\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Lock phases\n    kLock linseg 0, p3*0.5, 1, p3*0.5, 0\n    flocked pvslock fsig, kLock\n    \n    ; Synthesize\n    aOut pvsynth flocked\n    \n    outs aOut, aOut\nendin\n\ninstr 4\n    ; pvsbin opcode: kamp, kfr pvsbin fsig, kbin\n    ; Read individual bin values\n    ; kbin - bin number to read\n    \n    aIn buzz 0.3, 165, 25, -1\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Read specific bins\n    kBin = 10\n    kAmp, kFr pvsbin fsig, kBin\n    \n    ; Use bin data to control synthesis\n    aOsc oscili kAmp*5, kFr, -1\n    \n    ; Also output original\n    aOrig pvsynth fsig\n    \n    outs aOrig*0.5, aOsc*0.5\nendin\n\ninstr 5\n    ; pvscent opcode: kcent pvscent fsig\n    ; Calculate spectral centroid\n    \n    aIn vco2 0.3, 110, 10\n    aIn *= linseg(1, p3*0.5, 0.3, p3*0.5, 1)\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Get centroid\n    kCent pvscent fsig\n    \n    ; Use centroid to modulate filter\n    aFilt butterlp aIn, kCent*2\n    \n    ; Synthesize\n    aOut pvsynth fsig\n    \n    outs aOut*0.5 + aFilt*0.5, aOut*0.5 + aFilt*0.5\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 4\ni3 10 3\ni4 14 3\ni5 18 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
