{"instruction": "Write a CSound instrument that demonstrates general convolution opcodes: convolve, dconv, ftconv, pconvolve", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Create impulse response tables\ngiIR1 ftgen 0, 0, 8192, 10, 1, 0.5, 0.3, 0.2, 0.1, 0.05  ; Simple harmonic IR\ngiIR2 ftgen 0, 0, 4096, 7, 0, 100, 1, 100, 0.5, 200, 0.2, 3696, 0  ; Decay envelope IR\n\ninstr 1\n    ; convolve opcode: ar1 [, ar2] convolve ain, ifilcod [, ichannel]\n    ; Time-domain convolution with impulse response file\n    ; ifilcod - filename or function table\n    ; ichannel - channel number for stereo files\n    \n    ; Note: In practice, this uses an external IR file\n    ; For this example, we'll simulate with filtering\n    \n    ; Dry signal\n    aIn oscili 0.3, 220, -1\n    aIn *= linseg(1, 0.01, 1, 0.1, 0, p3-0.11, 0)\n    \n    ; Simulate convolution with comb filter\n    aDel1 delayr 0.05\n    aTap1 deltap 0.029\n          delayw aIn\n    \n    aDel2 delayr 0.1\n    aTap2 deltap 0.047\n          delayw aIn + aTap1*0.5\n    \n    aOut = aIn + aTap1*0.6 + aTap2*0.4\n    \n    outs aOut, aOut\nendin\n\ninstr 2\n    ; dconv opcode: ar1 dconv asig, isize, ifn\n    ; Direct convolution with function table\n    ; isize - partition size (power of 2)\n    ; ifn - impulse response function table\n    \n    ; Input signal\n    aIn vco2 0.3, 330, 2, 0.5\n    aIn *= expseg(1, 0.01, 1, 0.2, 0.001, p3-0.21, 0.001)\n    \n    ; Convolve with IR table\n    aConv dconv aIn, 1024, giIR1\n    \n    outs aIn*0.3, aConv*0.7\nendin\n\ninstr 3\n    ; ftconv opcode: ar1 [, ar2] [, ar3] [, ar4] ftconv ain, ift, iplen [, iskipsamples] [, iirlen] [, iskipinit] [, iformat]\n    ; Fast convolution with function table\n    ; ift - impulse response table\n    ; iplen - partition length (power of 2, typically 256-2048)\n    ; iirlen - IR length (0=use full table)\n    \n    ; Input\n    aIn buzz 0.3, 220, 15, -1\n    aIn *= linseg(1, 0.01, 1, 0.15, 0, p3-0.16, 0)\n    \n    ; Fast convolution\n    aConv ftconv aIn, giIR2, 512\n    \n    outs aIn*0.3, aConv*0.7\nendin\n\ninstr 4\n    ; pconvolve opcode: ar1 [, ar2] [, ar3] [, ar4] pconvolve ain, ifilcod [, ipartitionsize] [, ichannel]\n    ; Partitioned convolution for long IRs\n    ; ifilcod - IR filename\n    ; ipartitionsize - partition size (default=512)\n    ; ichannel - channel selection\n    \n    ; Note: This would normally use an external IR file\n    ; Simulating with multi-tap delay\n    \n    aIn vco2 0.3, 165, 0\n    aIn *= linseg(1, 0.01, 1, 0.1, 0, p3-0.11, 0)\n    \n    ; Multi-tap simulation of IR\n    aDel delayr 0.5\n    aT1 deltap 0.029\n    aT2 deltap 0.037\n    aT3 deltap 0.053\n    aT4 deltap 0.071\n    aT5 deltap 0.097\n        delayw aIn + (aT1+aT2+aT3+aT4+aT5)*0.3\n    \n    aOut = aIn + aT1*0.7 + aT2*0.5 + aT3*0.35 + aT4*0.2 + aT5*0.1\n    \n    outs aOut, aOut\nendin\n\ninstr 5\n    ; Creative convolution: using musical signals as IRs\n    ; \"Convolve\" a percussive sound with a harmonic sound\n    \n    ; Percussive signal\n    aPerc rand 0.5\n    aPerc *= expseg(1, 0.005, 0.3, 0.05, 0.01, p3-0.055, 0.001)\n    \n    ; \"IR\" - harmonic content\n    aHarm buzz 0.3, 110, 30, -1\n    \n    ; Store harmonic signal in table for convolution\n    giConvRT ftgen 0, 0, 16384, 7, 0, 16384, 0\n    \n    ; Simulate convolution effect with filtering\n    aFilt1 butterbp aPerc, 220, 100\n    aFilt2 butterbp aPerc, 440, 150\n    aFilt3 butterbp aPerc, 660, 200\n    \n    aOut = aPerc*0.4 + aFilt1*0.3 + aFilt2*0.2 + aFilt3*0.1\n    \n    outs aOut, aOut\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 4 3\ni3 8 3\ni4 12 3\ni5 16 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
