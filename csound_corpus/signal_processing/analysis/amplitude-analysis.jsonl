{"instruction": "Write a CSound instrument that demonstrates amplitude analysis opcodes: rms, balance, follow, follow2", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; rms opcode: kres rms asig [, ihp] [, iskip]\n    ; Calculate RMS (root mean square) amplitude\n    ; ihp - half-power point for internal filter (Hz)\n    ; iskip - skip initialization\n    \n    ; Signal with varying amplitude\n    kAmp linseg 0.1, p3*0.3, 0.8, p3*0.4, 0.3, p3*0.3, 0.1\n    aIn oscili kAmp, 440, -1\n    \n    ; Measure RMS\n    kRMS rms aIn\n    \n    ; Use RMS to control gain of another signal\n    aOsc2 buzz 0.5, 220, 10, -1\n    aOut = aOsc2 * kRMS * 2\n    \n    outs aIn*0.5, aOut*0.5\nendin\n\ninstr 2\n    ; balance opcode: ares balance asig, acomp [, ihp] [, iskip]\n    ; Match the power of asig to acomp\n    ; acomp - comparison signal\n    ; ihp - half-power point (Hz)\n    \n    ; Source signal with inconsistent amplitude\n    aSource vco2 0.5, 330, 10\n    aSource *= linseg(0.2, p3*0.25, 1, p3*0.5, 0.5, p3*0.25, 0.3)\n    \n    ; Reference signal with constant amplitude\n    aRef oscili 0.3, 330, -1\n    \n    ; Balance source to match reference\n    aBalanced balance aSource, aRef\n    \n    outs aSource*0.5, aBalanced*0.5\nendin\n\ninstr 3\n    ; follow opcode: ares follow asig, kdown [, kup]\n    ; Envelope follower\n    ; kdown - decay time (seconds)\n    ; kup - attack time (seconds, defaults to kdown/10)\n    \n    ; Input with amplitude variations\n    kMod lfo 0.5, 3, 0\n    aIn oscili 0.3+kMod, 220, -1\n    \n    ; Follow with different time constants\n    aEnv1 follow aIn, 0.1\n    aEnv2 follow aIn, 0.5, 0.01\n    \n    ; Use envelopes to control other signals\n    aOut1 buzz 0.4, 440, 15, -1\n    aOut1 *= aEnv1\n    \n    aOut2 vco2 0.4, 330, 0\n    aOut2 *= aEnv2\n    \n    outs aOut1, aOut2\nendin\n\ninstr 4\n    ; follow2 opcode: ares follow2 asig, katt, krel\n    ; Envelope follower with separate attack/release\n    ; katt - attack time (seconds)\n    ; krel - release time (seconds)\n    \n    ; Percussive input\n    aEnvIn expseg 1, 0.05, 0.3, 0.2, 0.1, p3-0.25, 0.001\n    aIn rand 0.5\n    aIn *= aEnvIN\n    \n    ; Follow with fast attack, slow release\n    aEnv follow2 aIn, 0.005, 0.3\n    \n    ; Apply to pitched sound\n    aOut oscili aEnv*0.5, 440, -1\n    \n    outs aIn*0.5, aOut*0.8\nendin\n\ninstr 5\n    ; Combining RMS and balance for dynamics control\n    ; Two signals of different levels\n    aSig1 vco2 0.2, 220, 0\n    aSig2 buzz 0.6, 330, 20, -1\n    \n    ; Measure their levels\n    kRMS1 rms aSig1\n    kRMS2 rms aSig2\n    \n    ; Balance sig2 to match sig1's level\n    aBalanced balance aSig2, aSig1\n    \n    ; Mix at equal perceived loudness\n    aMix = aSig1 + aBalanced*0.5\n    \n    outs aMix, aMix\nendin\n\ninstr 6\n    ; Envelope following for side-chain compression\n    ; Main signal\n    aMain vco2 0.4, 110, 10\n    \n    ; Side-chain trigger\n    aTrigger oscili 0.5, 2, -1\n    aTrigger *= expseg(1, 0.01, 0.3, 0.1, 0.1, 0.39, 0.001)\n    \n    ; Follow the trigger\n    aEnv follow2 aTrigger, 0.001, 0.15\n    \n    ; Duck the main signal\n    aDucked = aMain * (1 - aEnv*0.7)\n    \n    outs aDucked, aDucked\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 4 3\ni3 8 3\ni4 12 2\ni5 15 3\ni6 19 2\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
