{"instruction": "Write a CSound instrument that demonstrates spectral analysis opcodes: centroid, pvsfreeze, pvscross, pvsfilter", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; centroid opcode: kcent centroid asig [, itype] [, ifn] [, ikcount]\n    ; Spectral centroid calculation\n    ; itype - calculation type\n    ; ifn - window function\n    ; ikcount - number of samples\n    \n    ; Signal with changing spectral content\n    kCf linseg 500, p3*0.5, 3000, p3*0.5, 800\n    aIn butterlp buzz(0.3, 220, 30, -1), kCf\n    \n    ; Calculate centroid\n    kCent centroid aIn\n    \n    ; Use centroid to modulate another parameter\n    aOsc oscili 0.3, 440, -1\n    aOut butterlp aOsc, kCent*2\n    \n    outs aIn*0.5, aOut*0.5\nendin\n\ninstr 2\n    ; pvsfreeze opcode: fsig pvsfreeze fsigin, kfreeza, kfreezf\n    ; Freeze spectral amplitudes and/or frequencies\n    ; kfreeza - freeze amplitudes (0=off, 1=on)\n    ; kfreezf - freeze frequencies (0=off, 1=on)\n    \n    aIn vco2 0.3, 220, 0\n    \n    ; Analyze\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Freeze spectrum periodically\n    kFreezA linseg 0, p3*0.25, 0, 0.01, 1, p3*0.5, 1, 0.01, 0, p3*0.25-0.02, 0\n    kFreezF = 0\n    \n    ffrz pvsfreeze fsig, kFreezA, kFreezF\n    \n    ; Synthesize\n    aOut pvsynth ffrz\n    \n    outs aOut, aOut\nendin\n\ninstr 3\n    ; pvscross opcode: fsig pvscross fsrc, fdest, kamp1, kamp2\n    ; Cross-fade between two spectra\n    ; kamp1 - amplitude of source\n    ; kamp2 - amplitude of destination\n    \n    ; Two sources\n    aSrc buzz 0.3, 220, 20, -1\n    aDest vco2 0.3, 165, 10\n    \n    ; Analyze\n    fSrc pvsanal aSrc, 1024, 256, 1024, 1\n    fDest pvsanal aDest, 1024, 256, 1024, 1\n    \n    ; Cross-fade\n    kCross linseg 0, p3*0.5, 1, p3*0.5, 0\n    kAmp1 = 1 - kCross\n    kAmp2 = kCross\n    \n    fcross pvscross fSrc, fDest, kAmp1, kAmp2\n    \n    ; Synthesize\n    aOut pvsynth fcross\n    \n    outs aOut, aOut\nendin\n\ninstr 4\n    ; pvsfilter opcode: fsig pvsfilter fsigin, fsigfil, kdepth\n    ; Spectral filtering using another spectrum\n    ; fsigfil - filter spectrum\n    ; kdepth - filter depth (0-1)\n    \n    ; Input signal\n    aIn vco2 0.3, 330, 0\n    \n    ; Filter shape (noise burst)\n    aFilt rand 0.5\n    aFilt *= linseg(1, 0.1, 0, p3-0.1, 0)\n    \n    ; Analyze both\n    fIn pvsanal aIn, 1024, 256, 1024, 1\n    fFilt pvsanal aFilt, 1024, 256, 1024, 1\n    \n    ; Apply spectral filter\n    kDepth linseg 0, p3*0.3, 0.9, p3*0.4, 0.9, p3*0.3, 0\n    ffilt pvsfilter fIn, fFilt, kDepth\n    \n    ; Synthesize\n    aOut pvsynth ffilt\n    \n    outs aOut, aOut\nendin\n\ninstr 5\n    ; Combining centroid with spectral processing\n    aIn buzz 0.3, 165, 25, -1\n    \n    ; Calculate centroid\n    kCent centroid aIn\n    \n    ; Analyze for processing\n    fsig pvsanal aIn, 1024, 256, 1024, 1\n    \n    ; Freeze when centroid is high\n    kFreeze = (kCent > 2000 ? 1 : 0)\n    ffrz pvsfreeze fsig, kFreeze, 0\n    \n    ; Synthesize\n    aOut pvsynth ffrz\n    \n    outs aIn*0.4, aOut*0.6\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 3\ni3 9 4\ni4 14 3\ni5 18 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
