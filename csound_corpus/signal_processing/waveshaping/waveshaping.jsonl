{"instruction": "Write a CSound instrument that demonstrates waveshaping opcodes: distort, powershape, polynomial", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Waveshaping transfer functions\ngiShape1 ftgen 0, 0, 4097, 10, 1  ; Sine\ngiShape2 ftgen 0, 0, 4097, 7, -1, 2048, 0, 2049, 1  ; Triangle\ngiShape3 ftgen 0, 0, 4097, 5, 0.001, 2048, 1, 2049, 0.001  ; Exponential\ngiChebyshev ftgen 0, 0, 4097, 3, 1, 0, 2, 0, 1  ; Chebyshev (x + 2x^3 + x^5)\n\ninstr 1\n    ; distort opcode: ares distort asig, kdist, ifn [, ihp] [, istor]\n    ; Waveshaping with transfer function\n    ; kdist - distortion amount\n    ; ifn - transfer function table\n    ; ihp - high-pass filter frequency\n    \n    aIn oscili 0.3, 220, -1\n    \n    ; Variable distortion\n    kDist linseg 0, p3*0.5, 0.9, p3*0.5, 0\n    \n    aOut distort aIn, kDist, giShape1\n    \n    outs aIn*0.5, aOut*0.5\nendin\n\ninstr 2\n    ; powershape opcode: ares powershape asig, kShapeAmount [, ifullscale]\n    ; Power function waveshaping\n    ; kShapeAmount - exponent (>1 for expansion, <1 for compression)\n    \n    aIn vco2 0.4, 330, 10\n    \n    ; Time-varying shape\n    kShape linseg 0.5, p3*0.5, 3, p3*0.5, 1\n    \n    aOut powershape aIn, kShape\n    \n    outs aIn*0.5, aOut*0.5\nendin\n\ninstr 3\n    ; polynomial opcode: ares polynomial asig, k0, k1, k2 [, k3] [, k4] [...]\n    ; Polynomial waveshaping: y = k0 + k1*x + k2*x^2 + k3*x^3 + ...\n    \n    aIn oscili 0.3, 165, -1\n    \n    ; Polynomial coefficients\n    k0 = 0       ; DC offset\n    k1 = 1       ; Linear term\n    k2 = 0       ; Quadratic\n    k3 = 0.5     ; Cubic\n    k5 = 0.2     ; Quintic\n    \n    aOut polynomial aIn, k0, k1, k2, k3, 0, k5\n    \n    outs aIn*0.5, aOut*0.3\nendin\n\ninstr 4\n    ; Chebyshev polynomial waveshaping\n    ; Creates specific harmonics\n    \n    aIn oscili 0.3, 110, -1\n    \n    ; Chebyshev polynomials generate harmonics\n    ; T2(x) = 2x^2 - 1  (generates 2nd harmonic)\n    ; T3(x) = 4x^3 - 3x  (generates 3rd harmonic)\n    \n    aOut distort aIn, 0.7, giChebyshev\n    \n    outs aIn*0.5, aOut*0.5\nendin\n\ninstr 5\n    ; Multiple waveshaping stages\n    aIn oscili 0.3, 220, -1\n    \n    ; Stage 1: Soft clipping\n    a1 powershape aIn, 0.7\n    \n    ; Stage 2: Polynomial\n    a2 polynomial a1, 0, 1.2, 0, 0.3\n    \n    ; Stage 3: Table lookup\n    a3 distort a2, 0.5, giShape2\n    \n    outs aIn*0.3, a3*0.4\nendin\n\ninstr 6\n    ; Dynamic waveshaping\n    ; Shape amount controlled by input level\n    \n    aIn vco2 0.5, 165, 0\n    aIn *= linseg(0.2, p3*0.5, 1, p3*0.5, 0.3)\n    \n    ; Detect input level\n    kRMS rms aIn\n    \n    ; More distortion at higher levels\n    kDist = kRMS * 1.5\n    kDist limit kDist, 0, 0.95\n    \n    aOut distort aIn, kDist, giShape3\n    \n    outs aIn*0.4, aOut*0.6\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 4\ni3 10 3\ni4 14 4\ni5 19 4\ni6 24 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
