{"instruction": "Write a CSound instrument that demonstrates signal flow control opcodes: denorm, vactrol, lag, lagud, port, portk, tlineto", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; denorm opcode: ar denorm ain [, iflag]\n    ; Remove denormalized numbers (prevent CPU spikes)\n    ; iflag - processing flag\n    \n    aOsc oscili 0.3, 440, -1\n    aOsc *= expseg(1, p3-0.5, 0.0001, 0.5, 0.00000001)\n    \n    ; Apply denorm to prevent CPU issues with very small numbers\n    aClean denorm aOsc\n    \n    outs aClean, aClean\nendin\n\ninstr 2\n    ; vactrol opcode: ares vactrol asig, kattack, krelease [, ilevel]\n    ; Optical compressor-style envelope follower\n    ; kattack - attack time\n    ; krelease - release time\n    \n    aIn buzz 0.5, 220, 20, -1\n    aIn *= linseg(0.2, 0.1, 1, 0.3, 0.3, p3-0.4, 0.5)\n    \n    ; Vactrol envelope following\n    kAtt = 0.02\n    kRel = 0.25\n    aEnv vactrol aIn, kAtt, kRel\n    \n    ; Use envelope for dynamics\n    aOsc vco2 0.3, 330, 10\n    aOut = aOsc * aEnv * 2\n    \n    outs aIn*0.4, aOut*0.6\nendin\n\ninstr 3\n    ; lag opcode: kr lag ksig, klag [, initialvalue]\n    ; Exponential lag (portamento)\n    ; klag - lag time (seconds)\n    \n    ; Step changes in control signal\n    kStep linseg 220, 1, 220, 0.01, 440, 1, 440, 0.01, 330, p3-2.02, 330\n    \n    ; Apply lag\n    kLagTime = 0.3\n    kSmooth lag kStep, kLagTime\n    \n    ; Use for frequency control\n    aOsc oscili 0.3, kSmooth, -1\n    \n    outs aOsc, aOsc\nendin\n\ninstr 4\n    ; lagud opcode: kr lagud ksig, kup, kdown [, initialvalue]\n    ; Lag with separate up/down times\n    ; kup - attack time\n    ; kdown - release time\n    \n    kStep linseg 0.2, 0.5, 0.2, 0.01, 0.8, 0.5, 0.8, 0.01, 0.4, p3-1.02, 0.4\n    \n    ; Different up/down times\n    kUp = 0.05   ; Fast attack\n    kDown = 0.4  ; Slow release\n    kSmooth lagud kStep, kUp, kDown\n    \n    aOsc vco2 kSmooth, 440, 0\n    \n    outs aOsc, aOsc\nendin\n\ninstr 5\n    ; port opcode: kres port ksig, ihtim [, isig]\n    ; Portamento with half-time\n    ; ihtim - half-time (time to reach halfway to target)\n    \n    kTarget linseg 220, 1, 220, 0.01, 660, 1.5, 660, 0.01, 330, p3-2.52, 330\n    \n    ; Apply portamento\n    iHalfTime = 0.2\n    kSmooth port kTarget, iHalfTime\n    \n    aOsc oscili 0.3, kSmooth, -1\n    \n    outs aOsc, aOsc\nendin\n\ninstr 6\n    ; portk opcode: kres portk ksig, khtim [, isig]\n    ; K-rate portamento (time can vary)\n    ; khtim - half-time (k-rate)\n    \n    kTarget linseg 165, 1, 165, 0.01, 440, 1, 440, 0.01, 275, p3-2.02, 275\n    \n    ; Variable portamento time\n    kHalfTime linseg 0.05, p3*0.5, 0.5, p3*0.5, 0.1\n    kSmooth portk kTarget, kHalfTime\n    \n    aOsc vco2 0.3, kSmooth, 10\n    \n    outs aOsc, aOsc\nendin\n\ninstr 7\n    ; tlineto opcode: kres tlineto ksig, ktime\n    ; Linear interpolation to target value\n    ; ktime - time to reach target\n    \n    ; Target values\n    kTarget linseg 220, 1, 440, 1, 330, 1, 550, p3-3, 275\n    \n    ; Time to reach target (variable)\n    kTime linseg 0.3, p3*0.5, 0.8, p3*0.5, 0.2\n    \n    kSmooth tlineto kTarget, kTime\n    \n    aOsc oscili 0.3, kSmooth, -1\n    \n    outs aOsc, aOsc\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 4 3\ni3 8 4\ni4 13 3\ni5 17 4\ni6 22 4\ni7 27 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
