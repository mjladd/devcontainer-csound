{"instruction": "Write a CSound instrument that demonstrates ATS (Analysis-Transformation-Synthesis) opcodes: ATSread, ATSinfo, ATSbufread, ATSinterpread, ATSpartialtap", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; ATSread opcode: kfreq, kamp ATSread ktimepnt, iatsfile, ipartial\n    ; Read frequency and amplitude from ATS analysis file\n    ; ktimepnt - time pointer (seconds)\n    ; iatsfile - ATS file\n    ; ipartial - partial number\n    \n    ; Note: Requires ATS analysis file\n    ; Simulating with oscillator bank\n    \n    ; Time pointer\n    kTime line 0, p3, p3\n    \n    ; Simulate reading partials\n    ; In practice: kFr1, kAm1 ATSread kTime, \"file.ats\", 1\n    \n    ; Simulated partial data\n    kFr1 linseg 220, p3*0.5, 440, p3*0.5, 330\n    kAm1 linseg 0.2, p3*0.5, 0.4, p3*0.5, 0.3\n    \n    kFr2 = kFr1 * 2.01\n    kAm2 = kAm1 * 0.6\n    \n    kFr3 = kFr1 * 3.02\n    kAm3 = kAm1 * 0.4\n    \n    ; Synthesize partials\n    aOut1 oscili kAm1, kFr1, -1\n    aOut2 oscili kAm2, kFr2, -1\n    aOut3 oscili kAm3, kFr3, -1\n    \n    aOut = (aOut1 + aOut2 + aOut3) * 0.5\n    \n    outs aOut, aOut\nendin\n\ninstr 2\n    ; ATSinfo opcode: idata ATSinfo iatsfile, ilocation\n    ; Get information from ATS file\n    ; iatsfile - ATS file path\n    ; ilocation - what info to get (0=sample rate, 1=frame size, etc.)\n    \n    ; Note: Returns information at i-time\n    ; Simulating ATS playback\n    \n    ; Simulated partial bank\n    kTime line 0, p3, p3\n    \n    ; Multiple partials with varying amplitudes\n    iNumPartials = 8\n    aSum = 0\n    \n    indx = 1\n    while indx <= iNumPartials do\n        kFr = 110 * indx * (1 + indx*0.002)\n        kAm = 0.3 / indx\n        aPartial oscili kAm, kFr, -1\n        aSum = aSum + aPartial\n        indx += 1\n    od\n    \n    aSum *= 0.4\n    \n    outs aSum, aSum\nendin\n\ninstr 3\n    ; ATSbufread opcode: kfreq, kamp ATSbufread ktimepnt, kfmod, ibufno, ipartial\n    ; Read from buffered ATS data\n    ; ktimepnt - time pointer\n    ; kfmod - frequency modulation\n    ; ibufno - buffer number\n    ; ipartial - partial number\n    \n    kTime line 0, p3, p3\n    kFmod linseg 1, p3*0.5, 1.5, p3*0.5, 0.8\n    \n    ; Simulate frequency-scaled ATS partials\n    kFr1 = 165 * kFmod\n    kAm1 = 0.3\n    \n    kFr2 = 330 * kFmod * 1.01\n    kAm2 = 0.2\n    \n    kFr3 = 495 * kFmod * 1.02\n    kAm3 = 0.15\n    \n    aP1 oscili kAm1, kFr1, -1\n    aP2 oscili kAm2, kFr2, -1\n    aP3 oscili kAm3, kFr3, -1\n    \n    aOut = (aP1 + aP2 + aP3) * 0.5\n    \n    outs aOut, aOut\nendin\n\ninstr 4\n    ; ATSinterpread opcode: kfreq, kamp ATSinterpread ktimepnt, iatsfile, ipartial\n    ; Read with interpolation between frames\n    \n    kTime line 0, p3, p3\n    \n    ; Simulate smooth partial evolution\n    kFr1 linseg 220, p3*0.25, 330, p3*0.25, 275, p3*0.25, 440, p3*0.25, 330\n    kAm1 linseg 0.2, p3*0.25, 0.35, p3*0.25, 0.25, p3*0.25, 0.4, p3*0.25, 0.3\n    \n    kFr2 = kFr1 * 2.003\n    kAm2 = kAm1 * 0.7\n    \n    kFr3 = kFr1 * 3.007\n    kAm3 = kAm1 * 0.5\n    \n    kFr4 = kFr1 * 4.011\n    kAm4 = kAm1 * 0.3\n    \n    aP1 oscili kAm1, kFr1, -1\n    aP2 oscili kAm2, kFr2, -1\n    aP3 oscili kAm3, kFr3, -1\n    aP4 oscili kAm4, kFr4, -1\n    \n    aOut = (aP1 + aP2 + aP3 + aP4) * 0.4\n    \n    outs aOut, aOut\nendin\n\ninstr 5\n    ; ATSpartialtap opcode: kfreq, kamp ATSpartialtap ipartial\n    ; Tap specific partial from ATS data\n    ; ipartial - partial number to tap\n    \n    ; Simulate tapping different partials\n    kTime line 0, p3, p3\n    \n    ; Tap partials 1, 3, 5 (odd harmonics)\n    kFr1 = 110\n    kAm1 = 0.3\n    aP1 oscili kAm1, kFr1, -1\n    \n    kFr3 = 330 * 1.005\n    kAm3 = 0.2\n    aP3 oscili kAm3, kFr3, -1\n    \n    kFr5 = 550 * 1.008\n    kAm5 = 0.15\n    aP5 oscili kAm5, kFr5, -1\n    \n    aOut = (aP1 + aP3 + aP5) * 0.5\n    \n    outs aOut, aOut\nendin\n\ninstr 6\n    ; Complex ATS resynthesis simulation\n    ; Time-varying partial selection\n    \n    kTime line 0, p3, p3\n    \n    ; Number of active partials changes over time\n    kNumPartials linseg 3, p3*0.5, 12, p3*0.5, 5\n    \n    ; Generate partial bank\n    aSum = 0\n    indx = 1\n    while indx <= 12 do\n        kActive = (indx <= kNumPartials ? 1 : 0)\n        kFr = 110 * indx * (1 + indx*0.003)\n        kAm = kActive * (0.25 / indx)\n        aPartial oscili kAm, kFr, -1\n        aSum = aSum + aPartial\n        indx += 1\n    od\n    \n    aSum *= 0.4\n    \n    outs aSum, aSum\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 5 3\ni3 9 4\ni4 14 5\ni5 20 3\ni6 24 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
