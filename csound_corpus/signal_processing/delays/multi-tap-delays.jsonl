{"instruction": "Write a CSound instrument that demonstrates multi-tap delay opcodes: multitap, tapstop", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Table for tap times (in milliseconds)\ngitaps ftgen 1, 0, 8, -2, 100, 200, 350, 550, 800, 1100, 1500, 2000\n; Table for tap gains\ngigains ftgen 2, 0, 8, -2, 1.0, 0.8, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1\n\ninstr 1\n    ; multitap opcode: ares multitap asig [, itime1, igain1] [, itime2, igain2] [...]\n    ; Multi-tap delay with up to 20 taps\n    ; asig - input signal\n    ; itimeN - delay time for tap N (milliseconds)\n    ; igainN - gain for tap N\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Impulse source\n    aImp mpulse kAmp*0.5, 2\n    \n    ; Multi-tap delay with 4 taps\n    aDelayed multitap aImp, 100, 0.7, 250, 0.5, 450, 0.3, 700, 0.2\n    \n    ; Mix\n    aMix = aImp + aDelayed\n    \n    outs aMix, aMix\nendin\n\ninstr 2\n    ; Complex multi-tap delay\n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Pluck sound\n    aPluck pluck kAmp*0.4, 330, 330, 0, 1\n    \n    ; Multiple taps for dense echo\n    aDelayed multitap aPluck, \\\n        80, 0.8, \\\n        150, 0.7, \\\n        240, 0.6, \\\n        350, 0.5, \\\n        480, 0.4, \\\n        630, 0.3, \\\n        800, 0.25, \\\n        1000, 0.2\n    \n    aMix = aPluck + aDelayed\n    \n    outs aMix, aMix\nendin\n\ninstr 3\n    ; Rhythmic multi-tap delay\n    kAmp madsr 0.02, 0.12, 0.6, 0.3\n    \n    ; Short sound\n    aSaw vco2 kAmp*0.3, 220, 0\n    aEnv expon 1, 0.15, 0.01\n    aSound = aSaw * aEnv\n    \n    ; Rhythmic taps (120 BPM = 500ms per beat)\n    ; Taps at 1/16 notes\n    aDelayed multitap aSound, \\\n        125, 0.6, \\  ; 16th note\n        250, 0.5, \\  ; 8th note\n        375, 0.4, \\  ; dotted 8th\n        500, 0.35, \\ ; quarter note\n        750, 0.25    ; dotted quarter\n    \n    outs aDelayed, aDelayed\nendin\n\ninstr 4\n    ; tapstop is not a standard Csound opcode, \n    ; but we can demonstrate stopping delay taps dynamically\n    ; by using conditional processing\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Pulse wave\n    aPulse vco2 kAmp*0.3, 165, 2, 0.4\n    \n    ; Multi-tap with dynamic control\n    kTaps linseg 8, p3*0.5, 8, p3*0.5, 2\n    \n    ; Full delay\n    aDelayed multitap aPulse, \\\n        100, 0.7, \\\n        200, 0.6, \\\n        300, 0.5, \\\n        400, 0.4, \\\n        500, 0.3, \\\n        600, 0.25, \\\n        700, 0.2, \\\n        800, 0.15\n    \n    ; Fade out delayed signal\n    kFade = (kTaps > 4 ? 1 : kTaps/4)\n    aDelayed = aDelayed * kFade\n    \n    aMix = aPulse*0.5 + aDelayed\n    \n    outs aMix, aMix\nendin\n\ninstr 5\n    ; Stereo multi-tap delay\n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.3, 110, 0\n    \n    ; Different tap patterns for L/R\n    aDelayedL multitap aSaw, \\\n        120, 0.6, \\\n        280, 0.5, \\\n        480, 0.4, \\\n        720, 0.3\n    \n    aDelayedR multitap aSaw, \\\n        150, 0.6, \\\n        330, 0.5, \\\n        550, 0.4, \\\n        810, 0.3\n    \n    aL = aSaw*0.4 + aDelayedL\n    aR = aSaw*0.4 + aDelayedR\n    \n    outs aL, aR\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 3.5 2\ni3 6 3\ni4 9.5 4\ni5 14 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
