{"instruction": "Write a CSound instrument that demonstrates compression and limiting opcodes: compress, compress2, dam, clip", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; compress opcode: ares compress asig, actl, kthresh, kloknee, khiknee, kratio, katt, krel, ilook\n    ; Classic compressor with control signal\n    ; asig - input signal\n    ; actl - control signal (usually same as input)\n    ; kthresh - threshold (dB)\n    ; kloknee, khiknee - knee range (dB)\n    ; kratio - compression ratio\n    ; katt, krel - attack and release times (seconds)\n    ; ilook - lookahead time (seconds)\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Dynamic source\n    aOsc oscili kAmp*0.5, 440, -1, 0\n    \n    ; Compress\n    kThresh = -20\n    kLoKnee = 0\n    kHiKnee = 10\n    kRatio = 4\n    kAtt = 0.01\n    kRel = 0.1\n    iLook = 0.005\n    \n    aComp compress aOsc, aOsc, kThresh, kLoKnee, kHiKnee, kRatio, kAtt, kRel, iLook\n    \n    outs aComp, aComp\nendin\n\ninstr 2\n    ; compress2 opcode: ares compress2 asig, actl, kthresh, kloknee, khiknee, kratio, katt, krel, ilook\n    ; Updated compressor with improved algorithm\n    ; Same parameters as compress\n    \n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Varying amplitude source\n    kMod oscili 0.4, 0.5, -1, 0\n    aOsc oscili (0.3 + kMod)*kAmp, 330, -1, 0\n    \n    ; Heavier compression\n    kThresh = -15\n    kLoKnee = 0\n    kHiKnee = 5\n    kRatio = 8\n    kAtt = 0.005\n    kRel = 0.08\n    iLook = 0.01\n    \n    aComp compress2 aOsc, aOsc, kThresh, kLoKnee, kHiKnee, kRatio, kAtt, kRel, iLook\n    \n    outs aComp, aComp\nendin\n\ninstr 3\n    ; dam opcode: ares dam asig, kthresh, icomp1, icomp2, irtime, iftime\n    ; Dynamic amplitude modifier (compressor/expander)\n    ; asig - input signal\n    ; kthresh - threshold (0-1)\n    ; icomp1 - compression below threshold\n    ; icomp2 - compression above threshold\n    ; irtime - rise time (seconds)\n    ; iftime - fall time (seconds)\n    \n    kAmp madsr 0.02, 0.12, 0.6, 0.3\n    \n    ; Pulse wave\n    aPulse vco2 kAmp*0.4, 220, 2, 0.4\n    \n    ; Apply dam\n    kThresh = 0.3\n    iComp1 = 0.5  ; Expand below threshold\n    iComp2 = 2.0  ; Compress above threshold\n    iRTime = 0.01\n    iFTime = 0.1\n    \n    aDam dam aPulse, kThresh, iComp1, iComp2, iRTime, iFTime\n    \n    outs aDam, aDam\nendin\n\ninstr 4\n    ; clip opcode: ares clip asig, ktype, klimit [, iarg]\n    ; Soft/hard clipping limiter\n    ; asig - input signal\n    ; ktype - 0=Bram de Jong, 1=sine, 2=tanh (default 0)\n    ; klimit - clipping threshold (0-1)\n    ; iarg - optional argument for some types\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Hot signal\n    aSaw vco2 kAmp*0.8, 165, 0\n    \n    ; Soft clip\n    kType = 2  ; tanh\n    kLimit = 0.5\n    \n    aClip clip aSaw, kType, kLimit\n    \n    outs aClip, aClip\nendin\n\ninstr 5\n    ; Parallel compression\n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Rich source\n    aSaw1 vco2 kAmp*0.2, 110, 0\n    aSaw2 vco2 kAmp*0.2, 110.5, 0\n    aSrc = aSaw1 + aSaw2\n    \n    ; Heavy compression on parallel path\n    kThresh = -25\n    kRatio = 10\n    aComp compress2 aSrc, aSrc, kThresh, 0, 8, kRatio, 0.003, 0.05, 0.008\n    \n    ; Mix dry and compressed\n    aMix = aSrc*0.5 + aComp*0.5\n    \n    outs aMix, aMix\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 4.5 4\ni3 9 3\ni4 12.5 3\ni5 16 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
