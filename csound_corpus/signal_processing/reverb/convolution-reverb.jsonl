{"instruction": "Write a CSound instrument that demonstrates convolution reverb opcodes: convolve, dconv, ftconv", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Simple impulse response table\ngiIR ftgen 1, 0, 8192, 10, 1, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15, 0.1\n\ninstr 1\n    ; convolve opcode: ares convolve asig, ifilcod [, ichannel]\n    ; Convolve audio signal with impulse response file\n    ; asig - input signal\n    ; ifilcod - impulse response file (WAV/AIFF)\n    ; ichannel - channel to use from IR file\n    ; Note: Requires external IR file\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Impulse train for testing\n    aImp mpulse kAmp*0.5, 1.5\n    \n    ; Convolve (would use external IR file)\n    ; aConv convolve aImp, \"impulse_response.wav\"\n    \n    ; Simulated with simple delay network\n    aBuf delayr 0.5\n    aD1 deltap 0.05\n    aD2 deltap 0.12\n    aD3 deltap 0.23\n    aD4 deltap 0.38\n    delayw aImp\n    \n    aConv = aImp + aD1*0.6 + aD2*0.4 + aD3*0.3 + aD4*0.2\n    \n    outs aConv, aConv\nendin\n\ninstr 2\n    ; ftconv opcode: ares ftconv asig, ift, iplen [, iskip [, ilen [, iparts]]]\n    ; Fast table-based convolution\n    ; asig - input signal\n    ; ift - function table with impulse response\n    ; iplen - partition length (power of 2)\n    ; iskip - skip initialization\n    ; ilenExcerpt - length of IR to use\n    ; iparts - number of partitions\n    \n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Pluck sound\n    aPluck pluck kAmp*0.4, 330, 330, 0, 1\n    \n    ; Convolve with table\n    iPlen = 256\n    aConv ftconv aPluck, giIR, iPlen\n    \n    outs aConv, aConv\nendin\n\ninstr 3\n    ; dconv opcode: ares dconv asig, isize, ifn\n    ; Direct convolution\n    ; asig - input signal\n    ; isize - size of impulse response\n    ; ifn - function table with IR\n    \n    kAmp madsr 0.02, 0.12, 0.6, 0.3\n    \n    ; Pulse wave\n    aPulse vco2 kAmp*0.3, 220, 2, 0.4\n    aEnv expon 1, 0.15, 0.01\n    aSound = aPulse * aEnv\n    \n    ; Direct convolution\n    iSize = ftlen(giIR)\n    aConv dconv aSound, iSize, giIR\n    \n    outs aConv, aConv\nendin\n\ninstr 4\n    ; Complex IR with ftconv\n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.25, 165, 0\n    aEnv expon 1, 0.18, 0.01\n    aSound = aSaw * aEnv\n    \n    ; Partitioned convolution for efficiency\n    iPlen = 512\n    aConv ftconv aSound, giIR, iPlen\n    \n    ; Mix\n    aMix = aSound*0.2 + aConv*0.8\n    \n    outs aMix, aMix\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 3\ni2 3.5 3\ni3 7 3\ni4 10.5 4\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
