{"instruction": "Write a CSound instrument that demonstrates the doppler opcode for Doppler shift simulation", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; doppler opcode: aout doppler ain, ksourceposition, kmicposition [, isoundspeed, ifiltercutoff]\n    ; Simulates Doppler shift for moving sound source\n    ; ain - input signal\n    ; ksourceposition - source position (distance)\n    ; kmicposition - microphone position (usually 0)\n    ; isoundspeed - speed of sound (default 340.29 m/s)\n    ; ifiltercutoff - filter cutoff for interpolation\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Constant frequency source\n    aOsc oscili kAmp*0.3, 440, -1, 0\n    \n    ; Source moving past listener\n    kSourcePos linseg -50, p3*0.3, -5, p3*0.4, 5, p3*0.3, 50\n    kMicPos = 0\n    \n    ; Apply Doppler\n    aDoppler doppler aOsc, kSourcePos, kMicPos\n    \n    outs aDoppler, aDoppler\nendin\n\ninstr 2\n    ; Fast-moving source\n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.3, 330, 0\n    \n    ; Fast approach and departure\n    kSourcePos linseg -80, p3*0.2, -10, p3*0.6, 10, p3*0.2, 80\n    kMicPos = 0\n    iSoundSpeed = 340.29\n    \n    aDoppler doppler aSaw, kSourcePos, kMicPos, iSoundSpeed\n    \n    outs aDoppler, aDoppler\nendin\n\ninstr 3\n    ; Circular motion (simulated)\n    kAmp madsr 0.02, 0.12, 0.6, 0.3\n    \n    ; Pulse wave\n    aPulse vco2 kAmp*0.3, 220, 2, 0.4\n    \n    ; Circular path\n    kAngle linseg 0, p3, 6.283*2\n    kRadius = 20\n    kX = cos(kAngle) * kRadius\n    kZ = sin(kAngle) * kRadius\n    kSourcePos = sqrt(kX*kX + kZ*kZ)\n    \n    kMicPos = 0\n    \n    aDoppler doppler aPulse, kSourcePos, kMicPos\n    \n    ; Pan based on angle\n    kPan = (cos(kAngle) + 1) * 0.5\n    aL, aR pan aDoppler, kPan\n    \n    outs aL, aR\nendin\n\ninstr 4\n    ; Doppler with distance attenuation\n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Square wave\n    aSq vco2 kAmp*0.4, 165, 2\n    \n    ; Source motion\n    kSourcePos linseg -60, p3*0.25, -3, p3*0.5, 3, p3*0.25, 60\n    kMicPos = 0\n    \n    ; Apply Doppler\n    aDoppler doppler aSq, kSourcePos, kMicPos\n    \n    ; Distance attenuation\n    kDist = abs(kSourcePos) + 3\n    kAtten = 10 / (kDist + 1)\n    kAtten limit kAtten, 0, 1\n    \n    aOut = aDoppler * kAtten\n    \n    outs aOut, aOut\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 5\ni2 5.5 4\ni3 10 6\ni4 16.5 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
