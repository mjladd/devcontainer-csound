{"instruction": "Write a CSound instrument that demonstrates ambisonic opcodes: bformenc, bformenc1, bformdec, bformdec1, bformdec2", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; bformenc opcode: aw, ax, ay, az bformenc asig, kalpha, kbeta\n    ; Encode mono signal to B-format (1st order ambisonics)\n    ; asig - input signal\n    ; kalpha - azimuth angle (0-360 degrees)\n    ; kbeta - elevation angle (-90 to 90 degrees)\n    ; Returns: W, X, Y, Z components\n    \n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Oscillator\n    aOsc oscili kAmp*0.3, 440, -1, 0\n    \n    ; Sweep azimuth\n    kAzimuth linseg 0, p3, 360\n    kElevation = 0\n    \n    ; Encode to B-format\n    aW, aX, aY, aZ bformenc aOsc, kAzimuth, kElevation\n    \n    ; Simple stereo decode (X for left-right)\n    aL = aW + aX\n    aR = aW - aX\n    \n    outs aL*0.7, aR*0.7\nendin\n\ninstr 2\n    ; bformenc1 opcode: aw, ax, ay, az, ar, as, at, au, av bformenc1 asig, kalpha, kbeta\n    ; 2nd order ambisonic encoding\n    ; Returns additional components for 2nd order\n    \n    kAmp madsr 0.015, 0.08, 0.65, 0.25\n    \n    ; Pulse wave\n    aPulse vco2 kAmp*0.3, 330, 2, 0.4\n    \n    ; Circular motion\n    kAngle linseg 0, p3, 6.283*2\n    kAzimuth = kAngle * 57.2958  ; radians to degrees\n    kElevation linseg -30, p3*0.5, 30, p3*0.5, -30\n    \n    ; Encode (1st order for compatibility)\n    aW, aX, aY, aZ bformenc aPulse, kAzimuth, kElevation\n    \n    ; Stereo decode\n    aL = aW + aX\n    aR = aW - aX\n    \n    outs aL*0.7, aR*0.7\nendin\n\ninstr 3\n    ; bformdec opcode: a1, a2, a3, a4 bformdec isetup, aw, ax, ay, az\n    ; Decode B-format to speaker array\n    ; isetup - speaker setup (1-5)\n    ; aw, ax, ay, az - B-format components\n    \n    kAmp madsr 0.02, 0.12, 0.6, 0.3\n    \n    ; Sawtooth\n    aSaw vco2 kAmp*0.25, 220, 0\n    \n    ; Encode with elevation\n    kAzimuth linseg 0, p3*0.5, 180, p3*0.5, 360\n    kElevation = 15\n    \n    aW, aX, aY, aZ bformenc aSaw, kAzimuth, kElevation\n    \n    ; Manual stereo decode\n    aL = aW + aX*0.707\n    aR = aW - aX*0.707\n    \n    outs aL*0.7, aR*0.7\nendin\n\ninstr 4\n    ; Multiple sources in ambisonic field\n    kAmp madsr 0.01, 0.1, 0.7, 0.2\n    \n    ; Three oscillators\n    aOsc1 oscili kAmp*0.15, 220, -1, 0\n    aOsc2 oscili kAmp*0.15, 330, -1, 0\n    aOsc3 oscili kAmp*0.15, 440, -1, 0\n    \n    ; Different positions\n    kAz1 = 0     ; Front\n    kAz2 = 120   ; Right rear\n    kAz3 = 240   ; Left rear\n    kEl = 0\n    \n    ; Encode each source\n    aW1, aX1, aY1, aZ1 bformenc aOsc1, kAz1, kEl\n    aW2, aX2, aY2, aZ2 bformenc aOsc2, kAz2, kEl\n    aW3, aX3, aY3, aZ3 bformenc aOsc3, kAz3, kEl\n    \n    ; Mix B-format channels\n    aW = aW1 + aW2 + aW3\n    aX = aX1 + aX2 + aX3\n    aY = aY1 + aY2 + aY3\n    aZ = aZ1 + aZ2 + aZ3\n    \n    ; Decode to stereo\n    aL = aW + aX*0.707\n    aR = aW - aX*0.707\n    \n    outs aL*0.7, aR*0.7\nendin\n\n</CsInstruments>\n<CsScore>\n\ni1 0 4\ni2 4.5 5\ni3 10 4\ni4 14.5 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
