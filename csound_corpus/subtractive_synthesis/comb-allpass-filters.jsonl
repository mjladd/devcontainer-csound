{"instruction": "Write a CSound instrument that demonstrates the comb opcode for creating metallic resonances", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 1\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; comb opcode: ares comb asig, krvt, ilpt [, iskip] [, insmps]\n    ; comb is a comb filter with a fixed delay time\n    ; asig - input audio signal\n    ; krvt - reverberation time (time for signal to decay to 1/1000 or -60dB)\n    ; ilpt - loop time (delay time in seconds)\n    ; iskip - skip initialization flag (optional)\n    ; insmps - loop time in samples (optional)\n    \n    ; Amplitude envelope\n    kAmp linseg 0, 0.01, 0.6, p3-0.2, 0.6, 0.19, 0\n    \n    ; Short impulse as excitation\n    aImpulse mpulse kAmp, 0\n    \n    ; Comb filter creates pitched resonance\n    ; Loop time determines pitch: 1/freq = loop time\n    iLoopTime = 1/220  ; Creates 220 Hz resonance\n    kRvt = 1.5         ; Decay time\n    \n    ; Apply comb filter\n    aRes comb aImpulse, kRvt, iLoopTime\n    \n    out aRes\nendin\n\ninstr 2\n    ; Plucked string simulation\n    kAmp madsr 0.001, 0.1, 0.3, 0.2\n    \n    ; Noise burst for initial excitation\n    aNoise noise kAmp*0.8, 0\n    aExcite = aNoise * (1 - linseg(0, 0.03, 1, 0.001, 1))\n    \n    ; Comb filter creates pitched tone from noise\n    iFreq = p4\n    iLoopTime = 1/iFreq\n    kRvt = 3\n    \n    aPluck comb aExcite, kRvt, iLoopTime\n    \n    out aPluck*0.5\nendin\n\ninstr 3\n    ; Metallic percussion\n    kAmp linseg 0.7, 0.001, 0.6, p3-0.001, 0\n    \n    ; Impulse excitation\n    aImp mpulse kAmp, 0\n    \n    ; Multiple inharmonic comb filters\n    iLoop1 = 1/287\n    iLoop2 = 1/435\n    iLoop3 = 1/678\n    \n    aComb1 comb aImp, 0.8, iLoop1\n    aComb2 comb aImp, 0.6, iLoop2\n    aComb3 comb aImp, 0.5, iLoop3\n    \n    aMix = aComb1 + aComb2*0.7 + aComb3*0.5\n    \n    out aMix*0.4\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic comb resonance\ni1 0 2\ni1 2.5 2\n\n; Play plucked string at different pitches\ni2 5 2 220\ni2 6 2 330\ni2 7 2 440\n\n; Play metallic percussion\ni3 9.5 1.5\ni3 10.5 1.5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the vcomb opcode for time-varying comb filtering", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; vcomb opcode: ares vcomb asig, krvt, xlpt, imaxlpt [, iskip] [, insmps]\n    ; vcomb is a comb filter with variable delay time\n    ; asig - input audio signal\n    ; krvt - reverberation time\n    ; xlpt - loop time (can be k-rate or a-rate)\n    ; imaxlpt - maximum loop time\n    ; iskip - skip initialization flag (optional)\n    ; insmps - use samples instead of seconds (optional)\n    \n    ; Amplitude envelope\n    kAmp linseg 0, 0.01, 0.5, p3-0.2, 0.5, 0.19, 0\n    \n    ; Impulse train as excitation\n    aExcite mpulse kAmp*0.6, 8\n    \n    ; Sweep the comb frequency (pitch bend effect)\n    kLoopTime linseg 1/220, p3, 1/440\n    kRvt = 2\n    iMaxLoop = 1/100  ; Maximum delay time\n    \n    ; Apply variable comb filter\n    aRes vcomb aExcite, kRvt, kLoopTime, iMaxLoop\n    \n    outs aRes, aRes\nendin\n\ninstr 2\n    ; Vibrato effect with vcomb\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Noise excitation\n    aNoise noise kAmp*0.4, 0\n    aExcite = aNoise * (1 - linseg(0, 0.05, 1, 0.01, 1))\n    \n    ; Base frequency\n    iBaseFreq = 330\n    iBaseLoop = 1/iBaseFreq\n    \n    ; Add vibrato with LFO\n    kVib oscili 0.002, 5, giSine\n    kLoopTime = iBaseLoop + kVib\n    \n    kRvt = 2.5\n    iMaxLoop = 1/100\n    \n    aComb vcomb aExcite, kRvt, kLoopTime, iMaxLoop\n    \n    outs aComb*0.6, aComb*0.6\nendin\n\ninstr 3\n    ; Doppler-like pitch shifting\n    kAmp linseg 0, 0.05, 0.4, p3-0.1, 0.4, 0.05, 0\n    \n    ; Continuous excitation\n    aNoise noise kAmp*0.3, 0\n    \n    ; Rapid pitch change (like passing by)\n    kLoopTime expseg 1/600, p3*0.3, 1/200, p3*0.7, 1/800\n    \n    kRvt = 1.5\n    iMaxLoop = 1/100\n    \n    aComb vcomb aNoise, kRvt, kLoopTime, iMaxLoop\n    \n    outs aComb, aComb\nendin\n\ninstr 4\n    ; Flanging effect using vcomb\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Rich sawtooth source\n    aSaw vco2 kAmp*0.25, 220, 0\n    \n    ; Very short, modulated delay for flanging\n    kLFO oscili 0.005, 0.3, giSine\n    kLoopTime = 0.008 + kLFO\n    \n    kRvt = 0.3\n    iMaxLoop = 0.02\n    \n    aFlange vcomb aSaw, kRvt, kLoopTime, iMaxLoop\n    \n    ; Mix wet and dry\n    aMix = aSaw*0.5 + aFlange*0.5\n    \n    outs aMix, aMix\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play pitch sweep\ni1 0 4\n\n; Play vibrato\ni2 4.5 3\n\n; Play doppler effect\ni3 8 3\n\n; Play flanging\ni4 11.5 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the alpass opcode for allpass filtering in reverb design", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; alpass opcode: ares alpass asig, krvt, ilpt [, iskip] [, insmps]\n    ; alpass is an allpass filter with a fixed delay time\n    ; asig - input audio signal\n    ; krvt - reverberation time\n    ; ilpt - loop time (delay time in seconds)\n    ; iskip - skip initialization flag (optional)\n    ; insmps - loop time in samples (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.5, 0.3\n    \n    ; Simple tone to process\n    aOsc poscil kAmp*0.3, 440, giSine\n    \n    ; Single allpass filter\n    ; Allpass filters pass all frequencies but change phase relationships\n    iLoopTime = 0.03  ; 30ms delay\n    kRvt = 1.5\n    \n    aAP alpass aOsc, kRvt, iLoopTime\n    \n    outs aOsc*0.5, aAP*0.5\nendin\n\ninstr 2\n    ; Simple reverb using series allpass filters\n    kAmp madsr 0.005, 0.08, 0.4, 0.4\n    \n    ; Percussive sound\n    aPluck pluck kAmp*0.4, 330, 330, 0, 1\n    \n    ; Classic Schroeder reverb topology: 4 allpass filters in series\n    aAP1 alpass aPluck, 1.5, 0.0297\n    aAP2 alpass aAP1, 1.5, 0.0371\n    aAP3 alpass aAP2, 1.5, 0.0411\n    aAP4 alpass aAP3, 1.5, 0.0437\n    \n    ; Mix dry and wet\n    aLeft = aPluck*0.4 + aAP4*0.6\n    aRight = aPluck*0.4 + aAP4*0.6\n    \n    outs aLeft, aRight\nendin\n\ninstr 3\n    ; Dense reverb with parallel and series allpass\n    kAmp linseg 0, 0.01, 0.3, p3-0.2, 0.3, 0.19, 0\n    \n    ; Impulse excitation\n    aImp mpulse kAmp, 0\n    \n    ; First stage: parallel allpass filters\n    aAP1a alpass aImp, 1.0, 0.023\n    aAP1b alpass aImp, 1.0, 0.031\n    aPara = (aAP1a + aAP1b) * 0.5\n    \n    ; Second stage: series allpass filters\n    aAP2 alpass aPara, 1.8, 0.041\n    aAP3 alpass aAP2, 1.8, 0.053\n    aAP4 alpass aAP3, 1.8, 0.067\n    \n    outs aAP4, aAP4\nendin\n\ninstr 4\n    ; Diffusion network for room simulation\n    kAmp madsr 0.002, 0.05, 0.3, 0.5\n    \n    ; Hand clap (noise burst)\n    aNoise noise kAmp*0.5, 0\n    aClap = aNoise * (1 - linseg(0, 0.02, 1, 0.001, 1))\n    \n    ; Dense diffusion using multiple allpass stages\n    ; Short delays for early reflections\n    aAP1 alpass aClap, 0.8, 0.0051\n    aAP2 alpass aAP1, 0.8, 0.0071\n    aAP3 alpass aAP2, 0.8, 0.0093\n    aAP4 alpass aAP3, 0.8, 0.0113\n    \n    ; Longer delays for late reverb\n    aAP5 alpass aAP4, 2.0, 0.0371\n    aAP6 alpass aAP5, 2.0, 0.0479\n    \n    ; Stereo spread\n    aLeft = aClap*0.3 + aAP6*0.7\n    aRight = aClap*0.3 + aAP4*0.4 + aAP6*0.6\n    \n    outs aLeft, aRight\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic allpass\ni1 0 2\n\n; Play simple reverb\ni2 3 2\ni2 4 2\ni2 5 2\n\n; Play dense reverb\ni3 7.5 3\n\n; Play diffusion\ni4 11 2\ni4 12 2\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the valpass opcode for time-varying allpass filtering", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; valpass opcode: ares valpass asig, krvt, xlpt, imaxlpt [, iskip] [, insmps]\n    ; valpass is an allpass filter with variable delay time\n    ; asig - input audio signal\n    ; krvt - reverberation time\n    ; xlpt - loop time (can be k-rate or a-rate)\n    ; imaxlpt - maximum loop time\n    ; iskip - skip initialization flag (optional)\n    ; insmps - use samples instead of seconds (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.5, 0.3\n    \n    ; Source oscillator\n    aOsc poscil kAmp*0.3, 330, giSine\n    \n    ; Sweep allpass delay time\n    kLoopTime linseg 0.01, p3, 0.08\n    kRvt = 1.0\n    iMaxLoop = 0.1\n    \n    ; Apply variable allpass filter\n    aAP valpass aOsc, kRvt, kLoopTime, iMaxLoop\n    \n    outs aOsc*0.4, aAP*0.6\nendin\n\ninstr 2\n    ; Phaser effect using modulated valpass\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Rich sawtooth\n    aSaw vco2 kAmp*0.25, 220, 0\n    \n    ; LFO modulates allpass delay\n    kLFO oscili 0.008, 0.4, giSine\n    kLoopTime = 0.015 + kLFO\n    \n    kRvt = 0.5\n    iMaxLoop = 0.03\n    \n    ; Multiple stages for deeper phasing\n    aAP1 valpass aSaw, kRvt, kLoopTime, iMaxLoop\n    aAP2 valpass aAP1, kRvt, kLoopTime*1.3, iMaxLoop\n    aAP3 valpass aAP2, kRvt, kLoopTime*1.7, iMaxLoop\n    \n    ; Mix with dry signal\n    aMix = aSaw*0.4 + aAP3*0.6\n    \n    outs aMix, aMix\nendin\n\ninstr 3\n    ; Dynamic reverb with changing room size\n    kAmp linseg 0, 0.01, 0.3, p3-0.2, 0.3, 0.19, 0\n    \n    ; Percussive click\n    aClick mpulse kAmp*0.5, p3/8\n    \n    ; Room size changes over time\n    kRoomSize linseg 0.02, p3, 0.09\n    kRvt = 2.5\n    iMaxLoop = 0.1\n    \n    ; Series of allpass filters with changing delays\n    aAP1 valpass aClick, kRvt, kRoomSize*0.5, iMaxLoop\n    aAP2 valpass aAP1, kRvt, kRoomSize*0.7, iMaxLoop\n    aAP3 valpass aAP2, kRvt, kRoomSize*0.9, iMaxLoop\n    aAP4 valpass aAP3, kRvt, kRoomSize, iMaxLoop\n    \n    ; Stereo output\n    aLeft = aClick*0.2 + aAP4*0.8\n    aRight = aClick*0.2 + aAP3*0.6 + aAP4*0.4\n    \n    outs aLeft, aRight\nendin\n\ninstr 4\n    ; Chorus effect using short valpass filters\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; String-like tone\n    aSaw1 vco2 kAmp*0.15, 110, 0\n    aSaw2 vco2 kAmp*0.15, 110.2, 0\n    aMix = aSaw1 + aSaw2\n    \n    ; Two independent LFOs\n    kLFO1 oscili 0.004, 0.7, giSine\n    kLFO2 oscili 0.005, 0.53, giSine\n    \n    kLoop1 = 0.025 + kLFO1\n    kLoop2 = 0.032 + kLFO2\n    \n    kRvt = 0.3\n    iMaxLoop = 0.05\n    \n    ; Two voices for stereo chorus\n    aLeft valpass aMix, kRvt, kLoop1, iMaxLoop\n    aRight valpass aMix, kRvt, kLoop2, iMaxLoop\n    \n    ; Blend with dry\n    aLeft = aMix*0.5 + aLeft*0.5\n    aRight = aMix*0.5 + aRight*0.5\n    \n    outs aLeft, aRight\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play sweeping allpass\ni1 0 4\n\n; Play phaser\ni2 4.5 5\n\n; Play dynamic reverb\ni3 10 5\n\n; Play chorus\ni4 15.5 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates using comb and alpass filters together for realistic reverberation", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; Combine comb and alpass for Schroeder reverb\n    ; This is a classic reverb topology\n    \n    ; Amplitude envelope\n    kAmp madsr 0.003, 0.05, 0.3, 0.4\n    \n    ; Dry signal - short pluck\n    aPluck pluck kAmp*0.4, p4, p4, 0, 1\n    \n    ; Parallel comb filters (resonators)\n    kRvt = 2.5\n    aComb1 comb aPluck, kRvt, 0.0297\n    aComb2 comb aPluck, kRvt, 0.0371\n    aComb3 comb aPluck, kRvt, 0.0411\n    aComb4 comb aPluck, kRvt, 0.0437\n    \n    ; Sum parallel combs\n    aCombSum = (aComb1 + aComb2 + aComb3 + aComb4) * 0.25\n    \n    ; Series allpass filters (diffusion)\n    aAP1 alpass aCombSum, 1.5, 0.0050\n    aAP2 alpass aAP1, 1.5, 0.0017\n    \n    ; Mix dry and reverb\n    aLeft = aPluck*0.3 + aAP2*0.7\n    aRight = aPluck*0.3 + aAP1*0.5 + aAP2*0.5\n    \n    outs aLeft, aRight\nendin\n\ninstr 2\n    ; Large hall reverb with extended decay\n    kAmp linseg 0, 0.01, 0.25, p3-0.2, 0.25, 0.19, 0\n    \n    ; Hand clap excitation\n    aNoise noise kAmp*0.6, 0\n    aExcite = aNoise * (1 - linseg(0, 0.015, 1, 0.001, 1))\n    \n    ; Early reflections (short combs)\n    kRvtEarly = 0.8\n    aComb1 comb aExcite, kRvtEarly, 0.0133\n    aComb2 comb aExcite, kRvtEarly, 0.0157\n    aComb3 comb aExcite, kRvtEarly, 0.0179\n    aComb4 comb aExcite, kRvtEarly, 0.0211\n    aEarly = (aComb1 + aComb2 + aComb3 + aComb4) * 0.25\n    \n    ; Late reverberation (longer combs)\n    kRvtLate = 4.0\n    aComb5 comb aEarly, kRvtLate, 0.0451\n    aComb6 comb aEarly, kRvtLate, 0.0503\n    aComb7 comb aEarly, kRvtLate, 0.0571\n    aComb8 comb aEarly, kRvtLate, 0.0613\n    aLate = (aComb5 + aComb6 + aComb7 + aComb8) * 0.25\n    \n    ; Diffusion stage\n    aAP1 alpass aLate, 2.5, 0.0071\n    aAP2 alpass aAP1, 2.5, 0.0093\n    aAP3 alpass aAP2, 2.5, 0.0113\n    \n    ; Stereo placement\n    aLeft = aExcite*0.15 + aEarly*0.25 + aAP3*0.6\n    aRight = aExcite*0.15 + aEarly*0.3 + aAP2*0.4 + aAP3*0.5\n    \n    outs aLeft, aRight\nendin\n\ninstr 3\n    ; Modulated reverb with vcomb and valpass\n    kAmp madsr 0.01, 0.1, 0.4, 0.5\n    \n    ; Source tone\n    aOsc poscil kAmp*0.25, 220, giSine\n    \n    ; LFO for modulation\n    kLFO oscili 0.003, 0.25, giSine\n    \n    ; Variable comb filters\n    kLoop1 = 0.037 + kLFO\n    kLoop2 = 0.043 + kLFO*1.3\n    kRvt = 3.0\n    \n    aComb1 vcomb aOsc, kRvt, kLoop1, 0.05\n    aComb2 vcomb aOsc, kRvt, kLoop2, 0.05\n    aCombSum = (aComb1 + aComb2) * 0.5\n    \n    ; Variable allpass diffusion\n    kAPLoop = 0.015 + kLFO*0.5\n    aAP1 valpass aCombSum, 1.5, kAPLoop, 0.03\n    aAP2 valpass aAP1, 1.5, kAPLoop*1.4, 0.03\n    \n    ; Output\n    aMix = aOsc*0.2 + aAP2*0.8\n    \n    outs aMix, aMix\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play Schroeder reverb at different pitches\ni1 0 3 330\ni1 1.5 3 440\ni1 3 3 550\n\n; Play large hall\ni2 7 4\ni2 9 4\n\n; Play modulated reverb\ni3 13 6\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
