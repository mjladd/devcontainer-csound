{"instruction": "Write a CSound instrument that demonstrates the statevar opcode for state variable filtering", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; statevar opcode: ahp, alp, abp, abr statevar asig, kcf, kq [, iosamps] [, istor]\n    ; statevar is a state variable filter providing simultaneous outputs\n    ; asig - input audio signal\n    ; kcf - cutoff frequency (in Hz)\n    ; kq - resonance (Q factor, typically 1 to 20)\n    ; iosamps - oversampling factor (optional)\n    ; istor - skip initialization (optional)\n    ; Outputs: ahp (highpass), alp (lowpass), abp (bandpass), abr (band-reject)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.3, 220, 0\n    \n    ; Static filter\n    kCutoff = 800\n    kQ = 5\n    \n    ; Apply state variable filter\n    aHP, aLP, aBP, aBR statevar aSaw, kCutoff, kQ\n    \n    ; Output lowpass and highpass\n    outs aLP, aHP\nendin\n\ninstr 2\n    ; Sweep filter with all outputs\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Square wave source\n    aSq vco2 kAmp*0.25, 165, 2\n    \n    ; Sweep cutoff frequency\n    kCutoff expseg 200, p3, 4000\n    kQ = 8\n    \n    ; Get all filter outputs\n    aHP, aLP, aBP, aBR statevar aSq, kCutoff, kQ\n    \n    ; Use different outputs for left/right\n    outs aLP*0.8, aBP*0.8\nendin\n\ninstr 3\n    ; Resonant filter with modulated Q\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Rich sawtooth\n    aSaw vco2 kAmp*0.25, 110, 0\n    \n    ; Fixed cutoff, modulated resonance\n    kCutoff = 600\n    kLFO oscili 8, 0.5, giSine\n    kQ = 4 + kLFO\n    \n    ; Apply filter\n    aHP, aLP, aBP, aBR statevar aSaw, kCutoff, kQ\n    \n    ; Output bandpass for vocal-like effect\n    outs aBP, aBP\nendin\n\ninstr 4\n    ; Parallel filter bank using multiple statevars\n    kAmp madsr 0.005, 0.08, 0.5, 0.3\n    \n    ; White noise source\n    aNoise noise kAmp*0.3, 0\n    \n    ; Three filters at different frequencies\n    kQ = 10\n    \n    aHP1, aLP1, aBP1, aBR1 statevar aNoise, 400, kQ\n    aHP2, aLP2, aBP2, aBR2 statevar aNoise, 800, kQ\n    aHP3, aLP3, aBP3, aBR3 statevar aNoise, 1600, kQ\n    \n    ; Sum bandpass outputs for formant-like sound\n    aOut = (aBP1 + aBP2 + aBP3) * 0.5\n    \n    outs aOut, aOut\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play static filter\ni1 0 3\n\n; Play sweep\ni2 3.5 5\n\n; Play modulated Q\ni3 9 4\n\n; Play filter bank\ni4 13.5 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the svfilter opcode for multimode state variable filtering", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; svfilter opcode: alow, ahigh, aband, anotch svfilter asig, kcf, kq [, iscl] [, iskip]\n    ; svfilter is a state variable filter with four simultaneous outputs\n    ; asig - input audio signal\n    ; kcf - cutoff/center frequency (in Hz)\n    ; kq - resonance/Q factor\n    ; iscl - scale factor (optional)\n    ; iskip - skip initialization (optional)\n    ; Outputs: alow, ahigh, aband, anotch\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Bright sawtooth\n    aSaw vco2 kAmp*0.3, 330, 0\n    \n    ; Apply filter\n    kCutoff = 1000\n    kQ = 6\n    \n    aLow, aHigh, aBand, aNotch svfilter aSaw, kCutoff, kQ\n    \n    ; Demonstrate different outputs\n    outs aLow, aBand\nendin\n\ninstr 2\n    ; Morphing between filter types\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Square wave\n    aSq vco2 kAmp*0.25, 220, 2\n    \n    ; Filter parameters\n    kCutoff = 800\n    kQ = 8\n    \n    ; Get all outputs\n    aLow, aHigh, aBand, aNotch svfilter aSq, kCutoff, kQ\n    \n    ; Crossfade between filter types over time\n    kMix linseg 0, p3, 3\n    \n    ; 0-1: lowpass to bandpass\n    ; 1-2: bandpass to highpass  \n    ; 2-3: highpass to notch\n    if kMix < 1 then\n        aOut = aLow * (1-kMix) + aBand * kMix\n    elseif kMix < 2 then\n        aOut = aBand * (2-kMix) + aHigh * (kMix-1)\n    else\n        aOut = aHigh * (3-kMix) + aNotch * (kMix-2)\n    endif\n    \n    outs aOut, aOut\nendin\n\ninstr 3\n    ; TB-303 style acid bass\n    kAmp madsr 0.003, 0.05, 0.3, 0.2\n    \n    ; Sawtooth oscillator\n    aSaw vco2 kAmp*0.35, p4, 0\n    \n    ; Envelope-controlled filter\n    kFiltEnv madsr 0.01, 0.3, 0.2, 0.1\n    kCutoff = 200 + kFiltEnv * 2500\n    kQ = 12\n    \n    ; Apply resonant lowpass\n    aLow, aHigh, aBand, aNotch svfilter aSaw, kCutoff, kQ\n    \n    ; Add some bandpass for extra character\n    aOut = aLow*0.8 + aBand*0.2\n    \n    outs aOut, aOut\nendin\n\ninstr 4\n    ; Vocal formant synthesis using parallel filters\n    kAmp linseg 0, 0.05, 0.3, p3-0.1, 0.3, 0.05, 0\n    \n    ; Buzz source (vocal cords)\n    aBuzz buzz kAmp*0.3, 120, 40, giSine\n    \n    ; First formant (F1)\n    kF1 = 730   ; \"ah\" vowel\n    kQ1 = 8\n    aL1, aH1, aB1, aN1 svfilter aBuzz, kF1, kQ1\n    \n    ; Second formant (F2)\n    kF2 = 1090\n    kQ2 = 10\n    aL2, aH2, aB2, aN2 svfilter aBuzz, kF2, kQ2\n    \n    ; Third formant (F3)\n    kF3 = 2440\n    kQ3 = 12\n    aL3, aH3, aB3, aN3 svfilter aBuzz, kF3, kQ3\n    \n    ; Mix formants with appropriate levels\n    aOut = aB1*0.5 + aB2*0.3 + aB3*0.15\n    \n    outs aOut, aOut\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic filter\ni1 0 3\n\n; Play morphing\ni2 3.5 6\n\n; Play acid bass line\ni3 10 0.5 55\ni3 10.5 0.5 55\ni3 11 0.8 82.4\ni3 12 0.5 110\ni3 13 1 55\n\n; Play vowel\ni4 15 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the bqrez opcode for biquad resonant filtering", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; bqrez opcode: ares bqrez asig, xfco, xres [, imode] [, iskip]\n    ; bqrez is a biquad multi-mode filter\n    ; asig - input audio signal\n    ; xfco - cutoff/center frequency (Hz)\n    ; xres - resonance (bandwidth in Hz for bandpass, Q for lowpass/highpass)\n    ; imode - filter mode: 0=lowpass, 1=highpass, 2=bandpass (default=0)\n    ; iskip - skip initialization (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.3, 220, 0\n    \n    ; Lowpass mode with resonance\n    kCutoff = 1200\n    kRes = 20  ; High Q for resonance\n    iMode = 0  ; Lowpass\n    \n    ; Apply filter\n    aFilt bqrez aSaw, kCutoff, kRes, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 2\n    ; Sweep filter in highpass mode\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; White noise\n    aNoise noise kAmp*0.35, 0\n    \n    ; Sweep highpass cutoff\n    kCutoff expseg 100, p3, 5000\n    kRes = 8\n    iMode = 1  ; Highpass\n    \n    aFilt bqrez aNoise, kCutoff, kRes, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 3\n    ; Resonant bandpass for formant-like sound\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.25, 165, 0\n    \n    ; Bandpass mode with narrow bandwidth\n    kCenter = 800\n    kBW = 50    ; Bandwidth in Hz for bandpass mode\n    iMode = 2   ; Bandpass\n    \n    aFilt bqrez aSaw, kCenter, kBW, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 4\n    ; Self-oscillating filter\n    kAmp madsr 0.005, 0.08, 0.4, 0.3\n    \n    ; Low amplitude source\n    aExcite noise kAmp*0.05, 0\n    \n    ; Very high resonance causes self-oscillation\n    kCutoff = p4\n    kRes = 50   ; Extreme resonance\n    iMode = 0\n    \n    aFilt bqrez aExcite, kCutoff, kRes, iMode\n    \n    outs aFilt*0.3, aFilt*0.3\nendin\n\ninstr 5\n    ; Multi-mode filter with LFO modulation\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Square wave\n    aSq vco2 kAmp*0.25, 110, 2\n    \n    ; LFO modulates cutoff\n    kLFO oscili 1000, 0.4, giSine\n    kCutoff = 400 + kLFO\n    kRes = 15\n    \n    ; Switch between modes based on time\n    iMode = p4\n    \n    aFilt bqrez aSq, kCutoff, kRes, iMode\n    \n    outs aFilt, aFilt\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play lowpass\ni1 0 3\n\n; Play highpass sweep\ni2 3.5 4\n\n; Play bandpass\ni3 8 3\n\n; Play self-oscillation at different pitches\ni4 11.5 1 440\ni4 12.5 1 550\ni4 13.5 1 660\n\n; Play modulated filters in different modes\ni5 16 4 0  ; Lowpass\ni5 16 4 1  ; Highpass\ni5 16 4 2  ; Bandpass\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the rbjeq opcode for Robert Bristow-Johnson's EQ filters", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; rbjeq opcode: ares rbjeq asig, kfco, klvl, kQ, kS, imode [, iskip]\n    ; rbjeq implements various filter types using RBJ's Audio EQ Cookbook\n    ; asig - input audio signal\n    ; kfco - cutoff/center frequency (Hz)\n    ; klvl - level/gain (dB for peaking/shelving, not used for others)\n    ; kQ - Q factor (bandwidth)\n    ; kS - shelf slope (for shelving filters, 0.5 to 2)\n    ; imode - filter type: 0=lowpass, 1=highpass, 2=bandpass(BPF),\n    ;         3=band-reject, 4=peaking, 5=low-shelf, 6=high-shelf, 7=bandpass(CSG)\n    ; iskip - skip initialization (optional)\n    \n    ; Amplitude envelope\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.3, 220, 0\n    \n    ; Lowpass filter\n    kCutoff = 1000\n    kLevel = 0     ; Not used for lowpass\n    kQ = 0.707     ; Butterworth response\n    kS = 1         ; Not used for lowpass\n    iMode = 0      ; Lowpass\n    \n    aFilt rbjeq aSaw, kCutoff, kLevel, kQ, kS, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 2\n    ; Peaking EQ for tone shaping\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Full spectrum source\n    aSaw vco2 kAmp*0.25, 165, 0\n    \n    ; Boost at 800 Hz\n    kCenter = 800\n    kBoost = 12    ; 12 dB boost\n    kQ = 2\n    kS = 1\n    iMode = 4      ; Peaking EQ\n    \n    aFilt rbjeq aSaw, kCenter, kBoost, kQ, kS, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 3\n    ; Low-shelf EQ for bass adjustment\n    kAmp linseg 0, 0.05, 0.35, p3-0.1, 0.35, 0.05, 0\n    \n    ; Bass-heavy sawtooth\n    aSaw vco2 kAmp*0.25, 110, 0\n    \n    ; Boost low frequencies\n    kShelfFreq = 200\n    kBoost = 6     ; 6 dB boost\n    kQ = 1\n    kSlope = 1     ; Shelf slope\n    iMode = 5      ; Low-shelf\n    \n    aFilt rbjeq aSaw, kShelfFreq, kBoost, kQ, kSlope, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 4\n    ; High-shelf EQ for brightness\n    kAmp madsr 0.01, 0.12, 0.55, 0.35\n    \n    ; Square wave\n    aSq vco2 kAmp*0.25, 220, 2\n    \n    ; Boost high frequencies\n    kShelfFreq = 2000\n    kBoost = 8     ; 8 dB boost\n    kQ = 0.707\n    kSlope = 1.5\n    iMode = 6      ; High-shelf\n    \n    aFilt rbjeq aSq, kShelfFreq, kBoost, kQ, kSlope, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 5\n    ; Notch filter to remove frequency\n    kAmp madsr 0.005, 0.08, 0.5, 0.3\n    \n    ; White noise\n    aNoise noise kAmp*0.35, 0\n    \n    ; Notch out 1000 Hz\n    kNotch = 1000\n    kLevel = 0\n    kQ = 10        ; Narrow notch\n    kS = 1\n    iMode = 3      ; Band-reject (notch)\n    \n    aFilt rbjeq aNoise, kNotch, kLevel, kQ, kS, iMode\n    \n    outs aFilt, aFilt\nendin\n\ninstr 6\n    ; Multi-band EQ chain\n    kAmp madsr 0.01, 0.1, 0.6, 0.3\n    \n    ; Rich source\n    aSaw vco2 kAmp*0.25, 220, 0\n    \n    ; Low-shelf: boost bass\n    aEQ1 rbjeq aSaw, 100, 4, 1, 1, 5\n    \n    ; Peaking: cut muddy mids\n    aEQ2 rbjeq aEQ1, 400, -6, 2, 1, 4\n    \n    ; Peaking: boost presence\n    aEQ3 rbjeq aEQ2, 2000, 5, 2, 1, 4\n    \n    ; High-shelf: add air\n    aEQ4 rbjeq aEQ3, 8000, 3, 0.707, 1, 6\n    \n    outs aEQ4, aEQ4\nendin\n\ninstr 7\n    ; Dynamic EQ with modulated parameters\n    kAmp madsr 0.02, 0.15, 0.5, 0.4\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.25, 165, 0\n    \n    ; LFO modulates boost amount\n    kLFO oscili 8, 0.5, giSine\n    kBoost = 6 + kLFO\n    \n    ; Sweep center frequency\n    kCenter linseg 300, p3, 2000\n    \n    kQ = 3\n    kS = 1\n    iMode = 4  ; Peaking\n    \n    aFilt rbjeq aSaw, kCenter, kBoost, kQ, kS, iMode\n    \n    outs aFilt, aFilt\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play lowpass\ni1 0 3\n\n; Play peaking boost\ni2 3.5 3\n\n; Play low-shelf\ni3 7 3\n\n; Play high-shelf\ni4 10.5 3\n\n; Play notch\ni5 14 3\n\n; Play multi-band EQ\ni6 17.5 4\n\n; Play dynamic EQ\ni7 22 5\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates using statevar for synthesis with feedback and self-oscillation", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\n; Function table: sine wave\ngiSine ftgen 1, 0, 8192, 10, 1\n\ninstr 1\n    ; Self-oscillating statevar filter as sound source\n    kAmp linseg 0, 0.05, 0.25, p3-0.1, 0.25, 0.05, 0\n    \n    ; Tiny excitation signal\n    aNoise noise kAmp*0.01, 0\n    \n    ; Very high Q causes self-oscillation\n    kCutoff = p4\n    kQ = 40  ; Extreme resonance\n    \n    ; Filter self-oscillates to produce sine-like tone\n    aHP, aLP, aBP, aBR statevar aNoise, kCutoff, kQ\n    \n    ; Bandpass output is purest\n    outs aBP*0.4, aBP*0.4\nendin\n\ninstr 2\n    ; Feedback patching with statevar\n    kAmp madsr 0.01, 0.1, 0.5, 0.3\n    \n    ; Initial excitation\n    aExcite noise kAmp*0.2, 0\n    aExcite = aExcite * (1 - linseg(0, 0.1, 1, 0.01, 1))\n    \n    ; Initialize feedback\n    aFeedback init 0\n    \n    ; Mix excitation with feedback\n    aMix = aExcite + aFeedback*0.8\n    \n    ; Filter with moderate resonance\n    kCutoff = 400\n    kQ = 12\n    aHP, aLP, aBP, aBR statevar aMix, kCutoff, kQ\n    \n    ; Feed bandpass back\n    aFeedback = aBP\n    \n    outs aLP*0.5, aBP*0.5\nendin\n\ninstr 3\n    ; Karplus-Strong-like synthesis with statevar\n    kAmp linseg 0, 0.01, 0.4, p3-0.2, 0.4, 0.19, 0\n    \n    ; Noise burst\n    aNoise noise kAmp*0.6, 0\n    aBurst = aNoise * (1 - linseg(0, 0.02, 1, 0.001, 1))\n    \n    ; Initialize delay\n    aDelay init 0\n    \n    ; Mix burst with delayed signal\n    aMix = aBurst + aDelay*0.98\n    \n    ; Filter smooths the sound\n    iFreq = p4\n    kCutoff = iFreq * 3\n    kQ = 2\n    aHP, aLP, aBP, aBR statevar aMix, kCutoff, kQ\n    \n    ; Delay matches pitch\n    iDelTime = 1/iFreq\n    aDelay delay aLP, iDelTime\n    \n    outs aLP, aLP\nendin\n\ninstr 4\n    ; Dual filter with cross-feedback\n    kAmp madsr 0.005, 0.08, 0.45, 0.4\n    \n    ; Impulse train\n    aExcite mpulse kAmp*0.3, 10\n    \n    ; Initialize feedbacks\n    aFeed1 init 0\n    aFeed2 init 0\n    \n    ; First filter path\n    aMix1 = aExcite + aFeed2*0.3\n    aHP1, aLP1, aBP1, aBR1 statevar aMix1, 500, 8\n    aFeed1 = aBP1\n    \n    ; Second filter path at different frequency\n    aMix2 = aExcite + aFeed1*0.3\n    aHP2, aLP2, aBP2, aBR2 statevar aMix2, 750, 8\n    aFeed2 = aBP2\n    \n    ; Stereo output\n    outs aLP1*0.5 + aBP1*0.3, aLP2*0.5 + aBP2*0.3\nendin\n\ninstr 5\n    ; Modulated filter network\n    kAmp madsr 0.01, 0.12, 0.5, 0.35\n    \n    ; Sawtooth source\n    aSaw vco2 kAmp*0.25, 110, 0\n    \n    ; Initialize feedback\n    aFeedback init 0\n    \n    ; LFOs modulate parameters\n    kLFO1 oscili 400, 0.37, giSine\n    kLFO2 oscili 8, 0.23, giSine\n    \n    ; Mix with feedback\n    aMix = aSaw + aFeedback*0.4\n    \n    ; Filter with modulated parameters\n    kCutoff = 600 + kLFO1\n    kQ = 10 + kLFO2\n    aHP, aLP, aBP, aBR statevar aMix, kCutoff, kQ\n    \n    ; Multiple feedback paths\n    aFeedback = aBP*0.5 + aHP*0.2\n    \n    ; Mix outputs\n    aOut = aLP*0.6 + aBP*0.3 + aHP*0.1\n    \n    outs aOut, aOut\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play self-oscillating filters\ni1 0 2 440\ni1 1 2 550\ni1 2 2 660\n\n; Play feedback synthesis\ni2 5 3\n\n; Play Karplus-Strong-like\ni3 9 2 220\ni3 10 2 330\ni3 11 2 440\n\n; Play cross-feedback\ni4 14 4\n\n; Play modulated network\ni5 19 6\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
