{"instruction": "Write a CSound instrument that demonstrates the barmodel opcode for struck bar physical model", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; barmodel opcode: ares barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    ; barmodel implements a physical model of a struck bar (marimba, xylophone, etc.)\n    ; kbcL, kbcR - boundary conditions left and right (1=clamped, 2=pivoting, 3=free)\n    ; iK - dimensionless stiffness parameter\n    ; ib - high-frequency loss parameter (0-1)\n    ; kscan - scanning speed (typically 0.1-0.5)\n    ; iT30 - 30 dB decay time in seconds\n    ; ipos - position of strike (0-1)\n    ; ivel - velocity of strike\n    ; iwid - width of strike (spatial)\n    \n    ; Basic struck bar\n    kbcL = 1        ; Clamped left\n    kbcR = 1        ; Clamped right\n    iK = 0.25       ; Stiffness\n    ib = 0.001      ; Damping\n    kscan = 0.23\n    iT30 = 3        ; Decay time\n    ipos = 0.5      ; Strike center\n    ivel = 500      ; Strike velocity\n    iwid = 0.1285   ; Strike width\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    outs aBar, aBar\nendin\n\ninstr 2\n    ; Xylophone-like (free ends)\n    kbcL = 3        ; Free left end\n    kbcR = 3        ; Free right end\n    iK = 0.3\n    ib = 0.002      ; More damping\n    kscan = 0.25\n    iT30 = 1.5      ; Shorter decay\n    ipos = 0.4\n    ivel = 700\n    iwid = 0.12\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    outs aBar, aBar\nendin\n\ninstr 3\n    ; Marimba-like (low, mellow)\n    kbcL = 1\n    kbcR = 1\n    iK = 0.2        ; Less stiff\n    ib = 0.0008     ; Less damping\n    kscan = 0.2\n    iT30 = 4        ; Longer decay\n    ipos = 0.5\n    ivel = 400      ; Softer strike\n    iwid = 0.15     ; Wider strike\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    outs aBar, aBar\nendin\n\ninstr 4\n    ; Glockenspiel-like (bright, metallic)\n    kbcL = 1\n    kbcR = 1\n    iK = 0.4        ; Very stiff\n    ib = 0.0003     ; Very little damping\n    kscan = 0.3\n    iT30 = 6        ; Long decay\n    ipos = 0.3\n    ivel = 800      ; Hard strike\n    iwid = 0.08     ; Narrow strike\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    outs aBar*0.7, aBar*0.7\nendin\n\ninstr 5\n    ; Different strike positions\n    kbcL = 1\n    kbcR = 1\n    iK = 0.25\n    ib = 0.001\n    kscan = 0.23\n    iT30 = 3\n    ipos = p4       ; Strike position from score\n    ivel = 500\n    iwid = 0.1285\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    outs aBar, aBar\nendin\n\ninstr 6\n    ; Variable strike velocity (dynamics)\n    kbcL = 1\n    kbcR = 1\n    iK = 0.25\n    ib = 0.001\n    kscan = 0.23\n    iT30 = 3\n    ipos = 0.5\n    ivel = p4       ; Velocity from score\n    iwid = 0.1285\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    outs aBar, aBar\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic bar\ni1 0 3\ni1 3.5 3\n\n; Play xylophone\ni2 7.5 2\ni2 9.5 2\ni2 11.5 2\n\n; Play marimba\ni3 14.5 3\ni3 17.5 3\n\n; Play glockenspiel\ni4 21.5 4\ni4 25.5 4\n\n; Play different strike positions\n; Format: start dur position\ni5 30.5 2 0.2   ; Near edge\ni5 32.5 2 0.4\ni5 34.5 2 0.6\ni5 36.5 2 0.8\n\n; Play different velocities\n; Format: start dur velocity\ni6 39.5 2 300   ; Soft\ni6 41.5 2 500   ; Medium\ni6 43.5 2 700   ; Hard\ni6 45.5 2 900   ; Very hard\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the shaker opcode for physical model shaker", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; shaker opcode: ares shaker kamp, kfreq [, iobjects] [, itype]\n    ; shaker implements a physical model of shaken percussion (maraca, etc.)\n    ; kamp - amplitude (shake energy)\n    ; kfreq - shake frequency/rate in Hz\n    ; iobjects - number of objects/beads (default 64)\n    ; itype - type of shaker:\n    ;         0 = maraca\n    ;         1 = cabasa\n    ;         2 = sekere\n    ;         3 = guiro\n    ;         4 = water drops\n    ;         5 = bamboo chimes\n    ;         6 = tambourine\n    ;         7 = sleigh bells\n    ;         8 = sticks\n    ;         9 = crunch\n    ;         10 = wrench\n    ;         11 = sandpaper\n    ;         12 = coke can\n    ;         13 = next mug\n    ;         14 = penny + mug\n    ;         15 = nickle + mug\n    ;         16 = dime + mug\n    ;         17 = quarter + mug\n    ;         18 = franc + mug\n    ;         19 = peso + mug\n    ;         20 = big rocks\n    ;         21 = little rocks\n    ;         22 = tuned bamboo chimes\n    \n    ; Basic maraca\n    kAmp linseg 0, 0.02, 0.8, p3-0.12, 0.6, 0.1, 0\n    kFreq = 8       ; Shake rate\n    \n    aShake shaker kAmp, kFreq, 64, 0\n    \n    outs aShake, aShake\nendin\n\ninstr 2\n    ; Cabasa\n    kAmp linseg 0, 0.05, 0.7, p3-0.15, 0.5, 0.1, 0\n    kFreq = 6\n    \n    aShake shaker kAmp, kFreq, 128, 1\n    \n    outs aShake, aShake\nendin\n\ninstr 3\n    ; Sekere\n    kAmp linseg 0, 0.03, 0.8, p3-0.13, 0.6, 0.1, 0\n    kFreq = 7\n    \n    aShake shaker kAmp, kFreq, 96, 2\n    \n    outs aShake, aShake\nendin\n\ninstr 4\n    ; Tambourine\n    kAmp linseg 0, 0.02, 0.9, p3-0.12, 0.7, 0.1, 0\n    kFreq = 10\n    \n    aShake shaker kAmp, kFreq, 64, 6\n    \n    outs aShake, aShake\nendin\n\ninstr 5\n    ; Sleigh bells\n    kAmp linseg 0, 0.02, 0.8, p3-0.12, 0.6, 0.1, 0\n    kFreq = 12\n    \n    aShake shaker kAmp, kFreq, 32, 7\n    \n    outs aShake, aShake\nendin\n\ninstr 6\n    ; Bamboo chimes\n    kAmp linseg 0, 0.05, 0.7, p3-0.15, 0.5, 0.1, 0\n    kFreq = 4       ; Slower shake\n    \n    aShake shaker kAmp, kFreq, 48, 5\n    \n    outs aShake, aShake\nendin\n\ninstr 7\n    ; Sandpaper blocks\n    kAmp linseg 0, 0.03, 0.8, p3-0.13, 0.6, 0.1, 0\n    kFreq = 8\n    \n    aShake shaker kAmp, kFreq, 256, 11\n    \n    outs aShake, aShake\nendin\n\ninstr 8\n    ; Variable shake rate\n    kAmp linseg 0, 0.02, 0.8, p3-0.12, 0.6, 0.1, 0\n    \n    ; Accelerando\n    kFreq linseg 4, p3, 16\n    \n    aShake shaker kAmp, kFreq, 64, 0\n    \n    outs aShake, aShake\nendin\n\ninstr 9\n    ; Rhythmic pattern\n    kAmp linseg 0, 0.02, 0.8, 0.1, 0.4, 0.15, 0.9, 0.1, 0.3, p3-0.37, 0\n    kFreq = 8\n    \n    aShake shaker kAmp, kFreq, 64, 0\n    \n    outs aShake, aShake\nendin\n\ninstr 10\n    ; Multi-shaker ensemble\n    kAmp linseg 0, 0.03, 0.6, p3-0.13, 0.4, 0.1, 0\n    \n    ; Different shakers with different rates\n    aMaraca shaker kAmp, 8, 64, 0\n    aCabasa shaker kAmp, 6, 128, 1\n    aTamb shaker kAmp, 10, 64, 6\n    \n    ; Mix with stereo spread\n    aLeft = aMaraca*0.6 + aCabasa*0.4 + aTamb*0.3\n    aRight = aMaraca*0.3 + aCabasa*0.5 + aTamb*0.6\n    \n    outs aLeft*0.7, aRight*0.7\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play maraca\ni1 0 1.5\ni1 2 1.5\n\n; Play cabasa\ni2 4.5 2\n\n; Play sekere\ni3 7.5 1.5\n\n; Play tambourine\ni4 10 1\ni4 11 1\ni4 12 1\n\n; Play sleigh bells\ni5 14 2\n\n; Play bamboo chimes\ni6 17 2.5\n\n; Play sandpaper\ni7 20.5 2\n\n; Play accelerando\ni8 23.5 2\n\n; Play rhythmic pattern\ni9 26.5 1.5\ni9 28 1.5\n\n; Play ensemble\ni10 30.5 3\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates the sekere opcode for physical model sekere", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; sekere opcode: ares sekere kamp, idettack [, inum] [, idamp] [, imaxshake]\n    ; sekere implements a physical model of a sekere (beaded gourd)\n    ; kamp - amplitude (shake energy)\n    ; idettack - period of time over which all sound is stopped\n    ; inum - number of beads (default 64)\n    ; idamp - damping factor (0-1, default 0.0)\n    ; imaxshake - maximum shake energy (default 0)\n    \n    ; Basic sekere\n    kAmp linseg 1, p3, 0\n    \n    aSekere sekere kAmp*0.6, p3\n    \n    outs aSekere, aSekere\nendin\n\ninstr 2\n    ; Sekere with shake pattern\n    ; Two-phase shake (pull up, shake down)\n    kAmp linseg 0, 0.02, 0.9, 0.08, 0.4, 0.15, 0.8, 0.1, 0.3, p3-0.35, 0\n    \n    aSekere sekere kAmp*0.6, p3, 64, 0.0\n    \n    outs aSekere, aSekere\nendin\n\ninstr 3\n    ; Dense sekere (more beads)\n    kAmp linseg 1, p3, 0\n    \n    ; More beads for denser texture\n    aSekere sekere kAmp*0.6, p3, 128, 0.02\n    \n    outs aSekere, aSekere\nendin\n\ninstr 4\n    ; Sparse sekere (fewer beads)\n    kAmp linseg 1, p3, 0\n    \n    ; Fewer beads for sparser sound\n    aSekere sekere kAmp*0.6, p3, 32, 0.0\n    \n    outs aSekere, aSekere\nendin\n\ninstr 5\n    ; Sekere with damping\n    kAmp linseg 1, p3, 0\n    \n    ; Higher damping for controlled sound\n    aSekere sekere kAmp*0.6, p3, 64, 0.15\n    \n    outs aSekere, aSekere\nendin\n\ninstr 6\n    ; Sekere roll (continuous shaking)\n    ; Oscillating amplitude\n    kAmp oscili 0.4, 6, -1, 0\n    kAmp = 0.5 + abs(kAmp)\n    kAmp = kAmp * linseg(1, p3*0.8, 0.8, p3*0.2, 0)\n    \n    aSekere sekere kAmp*0.6, p3, 64, 0.05\n    \n    outs aSekere, aSekere\nendin\n\ninstr 7\n    ; Sekere twist (back and forth)\n    ; Alternate direction shake\n    kAmp lfo 0.6, 3, 1  ; Square wave\n    kAmp = abs(kAmp) * linseg(1, p3, 0.5)\n    \n    aSekere sekere kAmp*0.6, p3, 64, 0.0\n    \n    outs aSekere, aSekere\nendin\n\ninstr 8\n    ; African rhythm pattern\n    ; Complex shake pattern\n    kTime timeinsts\n    kBeat = int(kTime * 4) % 4\n    \n    if kBeat == 0 then\n        kAmp = 0.9\n    elseif kBeat == 1 then\n        kAmp = 0.4\n    elseif kBeat == 2 then\n        kAmp = 0.7\n    else\n        kAmp = 0.5\n    endif\n    \n    kAmp = kAmp * linseg(1, p3, 0.3)\n    \n    aSekere sekere kAmp*0.6, p3, 64, 0.0\n    \n    outs aSekere, aSekere\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play basic sekere\ni1 0 1.5\ni1 2 1.5\n\n; Play shake pattern\ni2 4.5 1\ni2 5.5 1\ni2 6.5 1\n\n; Play dense sekere\ni3 8.5 2\n\n; Play sparse sekere\ni4 11.5 2\n\n; Play with damping\ni5 14.5 1.5\ni5 16 1.5\n\n; Play roll\ni6 18.5 2.5\n\n; Play twist\ni7 22 2\n\n; Play rhythm pattern\ni8 25 2\ni8 27 2\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates advanced physical modeling combinations", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; Percussion ensemble: barmodel + shakers\n    ; Marimba bars\n    kbcL = 1\n    kbcR = 1\n    iK = 0.2\n    ib = 0.0008\n    kscan = 0.2\n    iT30 = 4\n    ipos = 0.5\n    ivel = 400\n    iwid = 0.15\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    ; Shaker accent\n    kShakeAmp linseg 0, 0.02, 0.6, 0.1, 0.2, p3-0.12, 0\n    aShake shaker kShakeAmp, 10, 64, 0\n    \n    ; Mix\n    aMix = aBar*0.6 + aShake*0.4\n    \n    outs aMix, aMix\nendin\n\ninstr 2\n    ; Afro-Cuban percussion section\n    kAmp linseg 1, p3, 0\n    \n    ; Sekere (gourd)\n    kSekereAmp oscili 0.5, 4, -1, 0\n    kSekereAmp = 0.4 + abs(kSekereAmp)\n    aSekere sekere kSekereAmp*kAmp*0.5, p3, 64, 0.0\n    \n    ; Maraca\n    kMaracaAmp linseg 0, 0.02, 0.7, p3-0.12, 0.5, 0.1, 0\n    aMaraca shaker kMaracaAmp*kAmp*0.4, 8, 64, 0\n    \n    ; Cabasa\n    kCabasaAmp linseg 0, 0.05, 0.6, p3-0.15, 0.4, 0.1, 0\n    aCabasa shaker kCabasaAmp*kAmp*0.4, 6, 128, 1\n    \n    ; Mix with stereo spread\n    aLeft = aSekere*0.5 + aMaraca*0.6 + aCabasa*0.3\n    aRight = aSekere*0.5 + aMaraca*0.3 + aCabasa*0.6\n    \n    outs aLeft*0.7, aRight*0.7\nendin\n\ninstr 3\n    ; Mallet crescendo with shaker roll\n    ; Multiple bars at different pitches\n    kbcL = 1\n    kbcR = 1\n    iK = 0.25\n    ib = 0.001\n    kscan = 0.23\n    iT30 = 3\n    ipos = 0.5\n    iwid = 0.1285\n    \n    ; Crescendo velocity\n    kVel linseg 200, p3, 800\n    \n    ; Root, 3rd, 5th\n    aBar1 barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, kVel, iwid\n    aBar2 barmodel kbcL, kbcR, iK*1.25, ib, kscan, iT30, ipos, kVel, iwid\n    aBar3 barmodel kbcL, kbcR, iK*1.5, ib, kscan, iT30, ipos, kVel, iwid\n    \n    ; Shaker roll\n    kShakeAmp linseg 0.2, p3, 0.8\n    aShake shaker kShakeAmp*0.5, 12, 64, 6  ; Tambourine\n    \n    ; Mix\n    aBars = (aBar1 + aBar2 + aBar3) * 0.3\n    aMix = aBars + aShake*0.4\n    \n    outs aMix, aMix\nendin\n\ninstr 4\n    ; Tuned percussion melody with shaker accompaniment\n    ; Glockenspiel bars\n    kbcL = 1\n    kbcR = 1\n    iK = 0.4\n    ib = 0.0003\n    kscan = 0.3\n    iT30 = 6\n    ipos = 0.3\n    ivel = 700\n    iwid = 0.08\n    \n    ; Melodic pattern\n    kTime timeinsts\n    kNote = int(kTime * 2) % 4\n    \n    if kNote == 0 then\n        kFreqMult = 1\n    elseif kNote == 1 then\n        kFreqMult = 1.25\n    elseif kNote == 2 then\n        kFreqMult = 1.5\n    else\n        kFreqMult = 2\n    endif\n    \n    aBar barmodel kbcL, kbcR, iK*kFreqMult, ib, kscan, iT30, ipos, ivel, iwid\n    \n    ; Sleigh bells\n    kShakeAmp linseg 0, 0.02, 0.6, p3-0.12, 0.4, 0.1, 0\n    aShake shaker kShakeAmp*0.4, 10, 32, 7\n    \n    ; Mix\n    aMix = aBar*0.6 + aShake*0.4\n    \n    outs aMix*0.7, aMix*0.7\nendin\n\ninstr 5\n    ; Gamelan-inspired texture\n    ; Multiple bars with inharmonic tuning\n    kbcL = 1\n    kbcR = 1\n    ib = 0.0005\n    kscan = 0.25\n    iT30 = 8\n    ipos = 0.5\n    ivel = 500\n    iwid = 0.12\n    \n    ; Inharmonic ratios\n    aBar1 barmodel kbcL, kbcR, 0.2, ib, kscan, iT30, ipos, ivel, iwid\n    aBar2 barmodel kbcL, kbcR, 0.2*2.14, ib, kscan, iT30*0.9, ipos, ivel, iwid\n    aBar3 barmodel kbcL, kbcR, 0.2*3.76, ib, kscan, iT30*0.8, ipos, ivel, iwid\n    aBar4 barmodel kbcL, kbcR, 0.2*5.42, ib, kscan, iT30*0.7, ipos, ivel, iwid\n    \n    ; Bamboo chimes\n    kChimeAmp linseg 0, 0.05, 0.5, p3-0.15, 0.3, 0.1, 0\n    aChime shaker kChimeAmp*0.4, 3, 48, 5\n    \n    ; Mix with reverb\n    aBars = (aBar1*0.3 + aBar2*0.25 + aBar3*0.2 + aBar4*0.15)\n    aMix = aBars + aChime*0.5\n    \n    aRvbL, aRvbR freeverb aMix, aMix, 0.85, 0.6\n    \n    outs aRvbL*0.6, aRvbR*0.6\nendin\n\ninstr 6\n    ; Rhythmic ostinato\n    ; Xylophone pattern\n    kbcL = 3\n    kbcR = 3\n    iK = 0.3\n    ib = 0.002\n    kscan = 0.25\n    iT30 = 1.5\n    ipos = 0.4\n    ivel = 650\n    iwid = 0.12\n    \n    ; Repeating rhythmic pattern\n    kTime timeinsts\n    kStep = int(kTime * 8) % 8\n    \n    ; Velocity pattern\n    if kStep == 0 || kStep == 3 || kStep == 6 then\n        kBarVel = ivel\n    else\n        kBarVel = ivel * 0.3\n    endif\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, kBarVel, iwid\n    \n    ; Sekere pattern\n    kSekereAmp = (kStep % 2 == 0 ? 0.7 : 0.3)\n    kSekereAmp = kSekereAmp * linseg(1, p3, 0.5)\n    aSekere sekere kSekereAmp*0.5, p3, 64, 0.0\n    \n    ; Mix\n    aMix = aBar*0.6 + aSekere*0.4\n    \n    outs aMix, aMix\nendin\n\ninstr 7\n    ; Ambient percussion soundscape\n    ; Soft bar resonances\n    kbcL = 1\n    kbcR = 1\n    ib = 0.0002\n    kscan = 0.2\n    iT30 = 10\n    ipos = 0.5\n    ivel = 200\n    iwid = 0.18\n    \n    ; Random-like bar strikes\n    kRand randomi 0.15, 0.35, 0.5\n    \n    aBar1 barmodel kbcL, kbcR, kRand, ib, kscan, iT30, ipos, ivel, iwid\n    aBar2 barmodel kbcL, kbcR, kRand*1.618, ib, kscan, iT30*0.95, ipos+0.1, ivel, iwid\n    \n    ; Water drops texture\n    kDropAmp randomi 0.2, 0.5, 2\n    aDrop shaker kDropAmp*0.3, 3, 20, 4\n    \n    ; Bamboo chimes\n    kChimeAmp randomi 0.1, 0.4, 1.5\n    aChime shaker kChimeAmp*0.3, 2, 48, 5\n    \n    ; Mix all with heavy reverb\n    aMix = aBar1*0.3 + aBar2*0.3 + aDrop*0.2 + aChime*0.2\n    aRvbL, aRvbR freeverb aMix, aMix, 0.95, 0.8\n    \n    outs aRvbL*0.5, aRvbR*0.5\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play marimba with shaker\ni1 0 2\ni1 2.5 2\n\n; Play Afro-Cuban section\ni2 5.5 3\n\n; Play crescendo\ni3 9.5 4\n\n; Play melody with bells\ni4 14.5 4\n\n; Play gamelan texture\ni5 19.5 6\n\n; Play rhythmic ostinato\ni6 26.5 3\n\n; Play ambient soundscape\ni7 30.5 10\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
{"instruction": "Write a CSound instrument that demonstrates expressive physical modeling performance techniques", "input": "", "output": "<CsoundSynthesizer>\n<CsOptions>\n-odac\n</CsOptions>\n<CsInstruments>\n\nsr = 44100\nkr = 4410\nksmps = 10\nnchnls = 2\n0dbfs = 1\n\ninstr 1\n    ; Dynamic marimba phrase\n    kbcL = 1\n    kbcR = 1\n    iK = 0.2\n    ib = 0.0008\n    kscan = 0.2\n    iT30 = 4\n    iwid = 0.15\n    \n    ; Dynamic velocity curve\n    kVel linseg 250, p3*0.3, 600, p3*0.4, 500, p3*0.3, 300\n    \n    ; Position variation for timbral change\n    kPos linseg 0.45, p3, 0.55\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, kPos, kVel, iwid\n    \n    outs aBar, aBar\nendin\n\ninstr 2\n    ; Shaker crescendo with accelerando\n    ; Amplitude crescendo\n    kAmp linseg 0.2, p3*0.7, 0.9, p3*0.3, 0.6\n    \n    ; Frequency accelerando\n    kFreq linseg 4, p3*0.7, 16, p3*0.3, 12\n    \n    aShake shaker kAmp, kFreq, 64, 0\n    \n    outs aShake, aShake\nendin\n\ninstr 3\n    ; Sekere groove with syncopation\n    kTime timeinsts\n    kBeat = (kTime * 4)\n    \n    ; Syncopated rhythm pattern\n    kPhase = frac(kBeat)\n    \n    ; Complex amplitude envelope per beat\n    if kPhase < 0.25 then\n        kAmp = 0.8\n    elseif kPhase < 0.375 then\n        kAmp = 0.3\n    elseif kPhase < 0.5 then\n        kAmp = 0.6\n    elseif kPhase < 0.75 then\n        kAmp = 0.2\n    else\n        kAmp = 0.5\n    endif\n    \n    kAmp = kAmp * linseg(1, p3, 0.7)\n    \n    aSekere sekere kAmp*0.6, p3, 64, 0.0\n    \n    outs aSekere, aSekere\nendin\n\ninstr 4\n    ; Mallet roll (tremolo on bars)\n    kbcL = 1\n    kbcR = 1\n    iK = 0.25\n    ib = 0.001\n    kscan = 0.23\n    iT30 = 3\n    ipos = 0.5\n    iwid = 0.1285\n    \n    ; Rapid velocity modulation for roll\n    kRoll oscili 400, 12, -1, 0\n    kVel = 400 + abs(kRoll)\n    \n    ; Overall dynamics\n    kDyn linseg 0.5, p3*0.5, 1, p3*0.5, 0.7\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, kVel*kDyn, iwid\n    \n    outs aBar*0.7, aBar*0.7\nendin\n\ninstr 5\n    ; Call and response: bars and shakers\n    kTime timeinsts\n    kSection = int(kTime / 1) % 2\n    \n    if kSection == 0 then\n        ; Bar call\n        kbcL = 1\n        kbcR = 1\n        iK = 0.3\n        ib = 0.001\n        kscan = 0.23\n        iT30 = 2\n        ipos = 0.4\n        ivel = 600\n        iwid = 0.12\n        \n        aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n        \n        outs aBar, aBar\n    else\n        ; Shaker response\n        kAmp linseg 0, 0.02, 0.8, 0.5, 0.6, 0.48, 0\n        aShake shaker kAmp, 10, 64, 0\n        \n        outs aShake, aShake\n    endif\nendin\n\ninstr 6\n    ; Polyrhythmic percussion\n    ; 3 against 4 pattern\n    kTime timeinsts\n    \n    ; Bars in 3\n    kBar3 = (frac(kTime * 3) < 0.1 ? 1 : 0)\n    \n    kbcL = 1\n    kbcR = 1\n    iK = 0.28\n    ib = 0.0012\n    kscan = 0.22\n    iT30 = 2.5\n    ipos = 0.5\n    ivel = 550 * kBar3\n    iwid = 0.13\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    ; Sekere in 4\n    kSek4 = (frac(kTime * 4) < 0.15 ? 0.7 : 0.2)\n    aSekere sekere kSek4*0.6, p3, 64, 0.05\n    \n    ; Mix\n    aMix = aBar*0.6 + aSekere*0.4\n    \n    outs aMix, aMix\nendin\n\ninstr 7\n    ; Textural evolution\n    ; Morphing timbre over time\n    kMorph linseg 0, p3, 1\n    \n    ; Bar parameters change\n    kbcL = 1\n    kbcR = 1\n    iK = 0.2 + (kMorph * 0.2)  ; Increasing stiffness\n    ib = 0.002 - (kMorph * 0.0015)  ; Decreasing damping\n    kscan = 0.2 + (kMorph * 0.1)\n    iT30 = 3 + (kMorph * 4)  ; Increasing decay\n    ipos = 0.5\n    ivel = 500\n    iwid = 0.15 - (kMorph * 0.05)  ; Narrowing strike\n    \n    aBar barmodel kbcL, kbcR, iK, ib, kscan, iT30, ipos, ivel, iwid\n    \n    ; Shaker density increases\n    kShakeObjs = 32 + (kMorph * 96)\n    kShakeAmp = 0.3 + (kMorph * 0.4)\n    aShake shaker kShakeAmp, 8, kShakeObjs, 6\n    \n    ; Mix ratio changes\n    kBarAmt = 1 - (kMorph * 0.4)\n    kShakeAmt = 0.3 + (kMorph * 0.5)\n    \n    aMix = aBar*kBarAmt + aShake*kShakeAmt\n    \n    outs aMix*0.6, aMix*0.6\nendin\n\n</CsInstruments>\n<CsScore>\n\n; Play dynamic marimba\ni1 0 4\n\n; Play shaker crescendo\ni2 5 4\n\n; Play sekere groove\ni3 10 4\n\n; Play mallet roll\ni4 15 3\n\n; Play call and response\ni5 19 4\n\n; Play polyrhythm\ni6 24 4\n\n; Play textural evolution\ni7 29 8\n\ne\n</CsScore>\n</CsoundSynthesizer>"}
